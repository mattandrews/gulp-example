var requirejs,require,define;!function(e){function t(e,t){return g.call(e,t)}function n(e,t){var n,i,r,s,o,a,u,c,l,p,_,d=t&&t.split("/"),f=h.map,E=f&&f["*"]||{};if(e&&"."===e.charAt(0))if(t){for(d=d.slice(0,d.length-1),e=e.split("/"),o=e.length-1,h.nodeIdCompat&&m.test(e[o])&&(e[o]=e[o].replace(m,"")),e=d.concat(e),l=0;l<e.length;l+=1)if(_=e[l],"."===_)e.splice(l,1),l-=1;else if(".."===_){if(1===l&&(".."===e[2]||".."===e[0]))break;l>0&&(e.splice(l-1,2),l-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((d||E)&&f){for(n=e.split("/"),l=n.length;l>0;l-=1){if(i=n.slice(0,l).join("/"),d)for(p=d.length;p>0;p-=1)if(r=f[d.slice(0,p).join("/")],r&&(r=r[i])){s=r,a=l;break}if(s)break;!u&&E&&E[i]&&(u=E[i],c=l)}!s&&u&&(s=u,a=c),s&&(n.splice(0,a,s),e=n.join("/"))}return e}function i(t,n){return function(){var i=v.call(arguments,0);return"string"!=typeof i[0]&&1===i.length&&i.push(null),l.apply(e,i.concat([t,n]))}}function r(e){return function(t){return n(t,e)}}function s(e){return function(t){d[e]=t}}function o(n){if(t(f,n)){var i=f[n];delete f[n],E[n]=!0,c.apply(e,i)}if(!t(d,n)&&!t(E,n))throw new Error("No "+n);return d[n]}function a(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function u(e){return function(){return h&&h.config&&h.config[e]||{}}}var c,l,p,_,d={},f={},h={},E={},g=Object.prototype.hasOwnProperty,v=[].slice,m=/\.js$/;p=function(e,t){var i,s=a(e),u=s[0];return e=s[1],u&&(u=n(u,t),i=o(u)),u?e=i&&i.normalize?i.normalize(e,r(t)):n(e,t):(e=n(e,t),s=a(e),u=s[0],e=s[1],u&&(i=o(u))),{f:u?u+"!"+e:e,n:e,pr:u,p:i}},_={require:function(e){return i(e)},exports:function(e){var t=d[e];return"undefined"!=typeof t?t:d[e]={}},module:function(e){return{id:e,uri:"",exports:d[e],config:u(e)}}},c=function(n,r,a,u){var c,l,h,g,v,m,y=[],b=typeof a;if(u=u||n,"undefined"===b||"function"===b){for(r=!r.length&&a.length?["require","exports","module"]:r,v=0;v<r.length;v+=1)if(g=p(r[v],u),l=g.f,"require"===l)y[v]=_.require(n);else if("exports"===l)y[v]=_.exports(n),m=!0;else if("module"===l)c=y[v]=_.module(n);else if(t(d,l)||t(f,l)||t(E,l))y[v]=o(l);else{if(!g.p)throw new Error(n+" missing "+l);g.p.load(g.n,i(u,!0),s(l),{}),y[v]=d[l]}h=a?a.apply(d[n],y):void 0,n&&(c&&c.exports!==e&&c.exports!==d[n]?d[n]=c.exports:h===e&&m||(d[n]=h))}else n&&(d[n]=a)},requirejs=require=l=function(t,n,i,r,s){if("string"==typeof t)return _[t]?_[t](n):o(p(t,n).f);if(!t.splice){if(h=t,h.deps&&l(h.deps,h.callback),!n)return;n.splice?(t=n,n=i,i=null):t=e}return n=n||function(){},"function"==typeof i&&(i=r,r=s),r?c(e,t,n,i):setTimeout(function(){c(e,t,n,i)},4),l},l.config=function(e){return l(e)},requirejs._defined=d,define=function(e,n,i){n.splice||(i=n,n=[]),t(d,e)||t(f,e)||(f[e]=[e,n,i])},define.amd={jQuery:!0}}(),define("echo-8.0.0/meta",{NAME:"echo_js",VERSION:"8.0.0",API_VERSION:"10.0.0"}),define("echo-8.0.0/util/debug",["require"],function(e){"use strict";function t(e,t){"object"==typeof console&&"function"==typeof console[e]&&console[e](t)}function n(){s=!0}function i(e){s&&t("log",e)}function r(e){if(s)throw new Error("ECHO_DEBUG: "+e)}var s=!1;return{enable:n,info:i,warn:i,error:r}}),define("echo-8.0.0/util/methods",["require","./debug"],function(e){"use strict";function t(e){var n={};for(var i in e)try{e[i].constructor===Object?n[i]=t(e[i]):n[i]=e[i]}catch(r){n[i]=e[i]}return n}function n(e,i,r){var s=r?e:t(e);for(var o in i)try{i[o].constructor===Object?s[o]=n(s[o],i[o]):s[o]=i[o]}catch(a){s[o]=i[o]}return s}function i(e,t){for(var n in e)if(e.hasOwnProperty(n)&&e[n]===t)return!0;return!1}function r(e,i){for(var r=(i?t(e):e)||{},s=arguments,o=2,a=s.length;a>o;o++)"object"==typeof s[o]?n(r,s[o],!0):r[s[o]]=s[++o];return r}function s(e,t,n){return n?r(e,!0,t,n):r(e,!0,t)}function o(e,t,n){return e||(n?u.warn("AssertionFailed: "+t):u.error("AssertionFailed: "+t)),e}function a(e,t,n){return o(i(e,t),n)}var u=e("./debug");return{clone:t,combineObjects:n,addKV:s,containsValue:i,extend:r,assert:o,assertContainsValue:a}}),define("echo-8.0.0/config/keys",[],function(){"use strict";var e={ECHO_ENABLED:"enabled",ECHO_TRACE:"trace",ECHO_DEVICE_ID:"device_id",ECHO_NAME:"lib_name",ECHO_VERSION:"lib_version",USE_SSC:"use_ssc",SSC_HOSTNAME:"ssc_hostname",REPORTING_PROFILE:"reporting_profile",COMSCORE_ENABLED:"comscore.enabled",COMSCORE_HOST:"comscore.host",COMSCORE_SITE:"comscore.site",COMSCORE_CUSTOMER_ID:"comscore.customer_id",COMSCORE_PUBLISHER_SECRET:"comscore.publisher_secret",TEST_SERVICE_ENABLED:"test.enabled",TEST_SERVICE_URL:"test.url",RUM_ENABLED:"rum.enabled",RUM_URL:"rum.url",BARB_ENABLED:"barb.enabled",BARB_SITE_CODE:"barb.site_code",BARB_DEBUG:"barb.debug"};return e}),define("echo-8.0.0/enumerations",[],function(){"use strict";var e={ApplicationType:{WEB:"web",MOBILE_WEB:"mobile-web",RESPONSIVE:"responsive",MOBILE_APP:"mobile-app",BIGSCREEN_HTML:"bigscreen-html",BIGSCREEN_FLASH:"bigscreen-flash",BIGSCREEN_APP:"bigscreen-app",BIGSCREEN_CAST:"bigscreen-cast"},WindowState:{FULL:"full",NORMAL:"norm",MINIMISED:"min",MAXIMISED:"max"},MediaIdType:{VERSION:"version",CLIP:"clip",EPISODE:"episode",SERVICE:"service",VPID:"vpid"},AvType:{AUDIO:"audio",VIDEO:"video"},RetrievalType:{STREAM:"stream",DOWNLOAD:"download"},Form:{LONG:"long",SHORT:"short"},PIPsType:{CLIP:"clip",EPISODE:"ep"},MediaConsumptionMode:{ON_DEMAND:"od",LIVE:"li",DOWNLOAD:"dl"},EchoScheduleMode:{ON:"on",OFF:"off"},ManagedLabels:{EVENT_MASTER_BRAND:"event_master_brand",BBC_SITE:"bbc_site",IPLAYER_STATE:"iplayer_state",STORE_ED_TYPE:"store_ed_type",IPLAYER_AVAIL:"iplayer_avail",STORE_REFERRAL:"store_referral",BBC_HASHED_ID:"bbc_hid"},ReportingProfiles:{PUBLIC_SERVICE:{profileId:"public_service",customerId:"16060501",comscoreHost:"sa.bbc.co.uk",sscHost:".co.uk"},GNL:{profileId:"gnl",customerId:"19293874",comscoreHost:"scorecardresearch.com",sscHost:".com"},WORLD_SERVICE:{profileId:"world_service",customerId:"19999701",comscoreHost:"scorecardresearch.com",sscHost:".com"},WORLDWIDE_FEATURES:{profileId:"worldwide_features",customerId:"19774467",comscoreHost:"scorecardresearch.com",sscHost:".com"},STORE_NONCOMMERCIAL:{profileId:"store_noncommercial",customerId:"19774474",comscoreHost:"scorecardresearch.com",sscHost:".com"},STORE_COMMERCIAL:{profileId:"store_commercial",customerId:"19774472",comscoreHost:"scorecardresearch.com",sscHost:".com"},GNL_ACCEPTANCE:{profileId:"gnl_acceptance",customerId:"18897612",comscoreHost:"scorecardresearch.com",sscHost:".com"},WORLD_SERVICE_ACCEPTANCE:{profileId:"world_service_acceptance",customerId:"18897612",comscoreHost:"scorecardresearch.com",sscHost:".com"},WORLDWIDE_FEATURES_ACCEPTANCE:{profileId:"worldwide_features_acceptance",customerId:"18897612",comscoreHost:"scorecardresearch.com",sscHost:".com"}}};return e}),define("echo-8.0.0/live-playhead",[],function(){"use strict";function e(){this.reset()}return e.prototype.start=function(){this._isPlaying!==!0&&(this._isPlaying=!0,this._startTime=this._getCurrentTime())},e.prototype.reset=function(){this._isPlaying=!1,this._position=0,this._startTime=0},e.prototype.stop=function(){this._isPlaying&&(this._isPlaying=!1,this._position+=this._getCurrentTime()-this._startTime,this._startTime=0)},e.prototype.getPosition=function(){var e=this._position;return this._isPlaying===!0&&(e+=this._getCurrentTime()-this._startTime),e},e.prototype._getCurrentTime=function(){return Date.now||(Date.now=function(){return(new Date).getTime()}),Date.now()},e}),define("echo-8.0.0/delegate/comscore/label-keys",{BBC_APPLICATION_NAME:"app_name",BBC_APPLICATION_TYPE:"app_type",BBC_APPLICATION_VERSION:"app_version",BBC_COUNTER_NAME:"name",BBC_LANGUAGE:"language",DEVICE_ID:"istats_visitor_id",BBC_MEASUREMENT_LIB_NAME:"ml_name",BBC_MEASUREMENT_LIB_VERSION:"ml_version",ECHO_TRACE:"trace",ECHO_EVENT_NAME:"echo_event",EVENT_TRIGGERED_BY_USER:"ns_st_ui",STREAMSENSE_CUSTOM_EVENT_TYPE:"ns_st_ev",USER_ACTION_TYPE:"action_type",USER_ACTION_NAME:"action_name",PLAYLIST_END:"ns_st_pe",REWIND_FF_RATE:"ffrw_rate",COMSCORE_SITE:"ns_site",COMSCORE_CUSTOMER:"c2",COMSCORE_ENDPOINT:"comscore_endpoint",COMSCORE_ALIAS:"ns_alias",PLAYER_NAME:"ns_st_mp",PLAYER_VERSION:"ns_st_mv",PLAYER_WINDOW_STATE:"ns_st_ws",PLAYER_VOLUME:"ns_st_vo",PLAYER_POPPED:"bbc_st_pop",PLAYER_SUBTITLED:"bbc_st_sub",PLAYLIST_NAME:"ns_st_pl",PLAYLIST_CLIP_COUNT:"ns_st_cp",PLAYLIST_LENGTH:"ns_st_ca",MEDIA_PID:"ns_st_ci",MEDIA_LENGTH:"ns_st_cl",MEDIA_BITRATE:"ns_st_br",MEDIA_STREAM_TYPE:"ns_st_ty",MEDIA_IS_LIVE:"ns_st_li",MEDIA_EPISODE_ID:"episode_id",MEDIA_CLIP_ID:"clip_id",MEDIA_CLIP_NUMBER:"ns_st_cn",MEDIA_PART_NUMBER:"ns_st_pn",MEDIA_TOTAL_PARTS:"ns_st_tp",MEDIA_MEDIUM:"bbc_st_med",MEDIA_LIVE_OR_ONDEMAND:"bbc_st_lod",MEDIA_FORM:"bbc_st_mf",MEDIA_RETRIEVAL_TYPE:"bbc_st_ret",MEDIA_SCHEDULE_INDICATOR:"bbc_st_sch",MEDIA_CODEC:"bbc_st_co",MEDIA_CDN:"bbc_st_cdn",MEDIA_VERSION_ID:"version_id",MEDIA_SERVICE_ID:"service_id",MEDIA_AMBIGUOUS_ID:"ambig_ci",MEDIA_TIMESTAMP:"bbc_st_live_ts",APP_PLATFORM_NAME:"ns_ap_pn",APP_PLATFORM_RUNTIME:"ns_ap_pfm",APP_OS_VERSION:"ns_ap_pfv",APP_DEVICE_NAME:"ns_ap_device",APP_SCREEN_RESOLUTION:"ns_ap_res",APP_LANGUAGE:"ns_ap_lang",ENV_CHAR_SET:"ns_c",ENV_TITLE:"c8",ENV_URL:"c7",ENV_REFERRER:"c9",APP_NAME:"ns_ap_an",APP_VERSION:"ns_ap_ver",NO_COOKIES:"ns_nc",COOKIE_POLICY:"bbc_mc",BBC_ID_LOGGED_IN:"bbc_identity",WEB_SCREEN_RES:"screen_resolution"}),define("echo-8.0.0/live-broker",["require","./live-playhead","./delegate/comscore/label-keys"],function(e){"use strict";function t(e,t,i){this._versionPid=t,this._playerDelegate=e,this._playhead=new n,this._isStarted=!1,this._interval=null,this._echoClient=i}var n=e("./live-playhead"),i=e("./delegate/comscore/label-keys");return t.prototype.start=function(){var e=this;this._isStarted||(this._playhead.start(),this._interval=setInterval(function(){e._updateSchedule()},1e3),this._isStarted=!0)},t.prototype.stop=function(){clearInterval(this._interval),this._playhead.stop(),this._isStarted=!1},t.prototype._updateSchedule=function(){this._echoClient.addLabel(i.MEDIA_TIMESTAMP,this._playerDelegate.getTimestamp())},t.prototype.getPosition=function(){return this._playhead.getPosition()},t}),define("echo-8.0.0/config/generator",["require","../util/debug","../enumerations","../util/methods","../meta","./keys"],function(e){"use strict";function t(e){return"string"==typeof e&&e.length>0}function n(e){return e.match(/[a-zA-Z]+/)}function i(e){return!e.match(/\?/)}function r(e){return e=e.toUpperCase(),_.ReportingProfiles.hasOwnProperty(e)}function s(e){return d.assert("boolean"==typeof e[h.ECHO_ENABLED],'Config: "enabled" must be boolean, got '+e[h.ECHO_ENABLED])&&d.assert(null===e[h.ECHO_DEVICE_ID]||"string"==typeof e[h.ECHO_DEVICE_ID]&&e[h.ECHO_DEVICE_ID].length,"ECHO.DEVICE_ID must be an non-empty string")}function o(e){if(e[h.COMSCORE_ENABLED]===!1)return!0;if(!t(e[h.REPORTING_PROFILE])){if(!t(e[h.COMSCORE_HOST]))return p.error("Config Error: Must have config value for COMSCORE_HOST or REPORTING_PROFILE"),!1;if("scorecardresearch.com"!==e[h.COMSCORE_HOST]&&"sa.bbc.co.uk"!==e[h.COMSCORE_HOST])return p.error("Config Error: KEYS.COMSCORE_HOST Should be one of scorecardresearch.com or sa.bbc.co.uk"),!1}return r(e[h.REPORTING_PROFILE])?d.assert("boolean"==typeof e[h.COMSCORE_ENABLED],'ComScore config: "ENABLED" must be boolean'):(p.error("Config Error: KEYS.REPORTING_PROFILE Invalid reporting profile specified"),!1)}function a(e){return e[h.RUM_ENABLED]===!1?!0:d.assert(t(e[h.RUM_URL]),"RUM Config: Must have config value for RUM_URL")&&d.assert(i(e[h.RUM_URL]),'RUM Config: Tailing "?" and URL uparameters not allowedfor RUM.URL')&&d.assert("boolean"==typeof e[h.RUM_ENABLED],'RUM config: "ENABLED" bust be boolean')}function u(e){return e[h.BARB_ENABLED]===!1?!0:t(e[h.BARB_SITE_CODE])?n(e[h.BARB_SITE_CODE])?"boolean"!=typeof e[h.BARB_DEBUG]?(p.error("Config Error: KEYS.BARB_DEBUG must be a boolean"),!1):!0:(p.error("Config Error: KEYS.BARB_SITE_CODE must match [a-zA-Z]"),!1):(p.error("Config Error: KEYS.BARB_SITE_CODE must have a value"),!1)}function c(e){var t=e[h.SSC_HOSTNAME];return"boolean"!=typeof e[h.USE_SSC]?(p.error("Config Error: KEYS.USE_SSC must be boolean"),!1):null!==t&&".com"!==t&&".co.uk"!==t?(p.error("Config Error: SSC_HOSTNAME must be one of .com, .co.uk or null"),!1):!0}function l(e){var t=d.extend(E,!0,e||{},g);return s(t)&&o(t)&&a(t)&&u(t)&&c(t)?t:null}var p=e("../util/debug"),_=e("../enumerations"),d=e("../util/methods"),f=e("../meta"),h=e("./keys"),E={};E[h.ECHO_ENABLED]=!0,E[h.ECHO_DEVICE_ID]=null,E[h.REPORTING_PROFILE]="PUBLIC_SERVICE",E[h.COMSCORE_SITE]="bbc",E[h.COMSCORE_ENABLED]=!0,E[h.RUM_URL]="http://ingest.rum.bbc.co.uk",E[h.RUM_ENABLED]=!1,E[h.BARB_ENABLED]=!1,E[h.BARB_DEBUG]=!1,E[h.BARB_SITE_CODE]="bbcdotcom",E[h.TEST_SERVICE_ENABLED]=!1,E[h.USE_SSC]=!1,E[h.SSC_HOSTNAME]=null;var g={};return g[h.ECHO_NAME]=f.NAME,g[h.ECHO_VERSION]=f.VERSION,{generate:l}}),define("echo-8.0.0/util/cleansing/label-rules",{STRICT:"strict",COUNTERNAME:"countername",EVENT_MASTER_BRAND:"event_master_brand",NO_CLEANSING:"no_cleansing",CUSTOM:"custom"}),define("echo-8.0.0/util/cleansing/label-cleanser",["require","../methods","../debug","../../enumerations","./label-rules"],function(e){"use strict";function t(e){return E.hasOwnProperty(e)?E[e]:f.CUSTOM}function n(e){return e&&e.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/(^_+)|(_+$)/g,"")}function i(e){var t=n(e);return p.assert(e===t,'Label key can only contain: [a-z0-9_], and no consecutive "_"s or "_" at the begining or end, got "'+e+'". This will be sent as "'+t+'"',!0),t}function r(e){return n(e)}function s(e){return e&&e.toLowerCase().replace(/(^\s+)|(\s+$)/g,"").replace(/[^a-z0-9]+/g,"-").replace(/(^-+)|(-+$)/g,"")}function o(e){return e&&e.replace(/(^\s+)|(\s+$)/g,"").replace(/\|/g,"!")}function a(e){var t=e&&e.toLowerCase().replace(/[^a-z0-9\.]+/g,"_").replace(/\.+/g,".").replace(/(^_+)|(_+$)/g,"")||"no.name.page";return e!==t&&((null===e||"string"!=typeof e||0===e.replace(/ */,"").length)&&_.error("Countername must be a non-empty string"),e&&-1!==e.search(/-/)?_.warn('Submitted countername ("'+e+'") contains at least one "-". Dashes are not permitted but, for legacy reasons, "-" and "_" are equivalent in DAx. Echo converts dashes to underscores, so the countername will be sent as "'+t+'"'):_.warn('countername may only contain: [a-z0-9._], got "'+e+'". This will be cleaned up and sent as "'+t+'"')),-1===t.search(/\.page$/)&&(t+=".page"),t}function u(e,n){var i="",u=n,c=t(e);if(c===f.COUNTERNAME&&(n=a(n)),"number"==typeof n||"boolean"==typeof n)return n.toString();if("string"!=typeof n)return void _.error("Label must have number, boolean or string value");switch(c){case f.EVENT_MASTER_BRAND:i='Label value can only contain [0-9a-z], and no consecutive "_"s and no "_"s or whitespace at the start or end.',u=r(n);break;case f.STRICT:i='Strict Label values can only contain [ 0-9a-z-], and no consecutive "-"s and no "-"s or whitespace at the start or end.',u=s(n);break;case f.NO_CLEANSING:break;default:i="Custom Label value cannot contain whitespace at start or end or pipes (|).",u=o(n)}return i+='Got "'+n+'", will be replaced with "'+u+'"',p.assert(n===u,i,!0),u}function c(e){if("number"==typeof e||"boolean"==typeof e)return e.toString();var t=e&&e.replace(/(^\s*)|(\s*$)/g,"").replace(/[^0-9a-zA-Z._]+/g,"-").replace(/(^-)|(-$)/g,"")||"";return p.assert(e===t,'Language label value can only contain [0-9a-zA-Z._-], and no consecutive "-"s and no - at the start or end. Got "'+e+'", will be replaced with "'+t+'"',!0),t}function l(e){var t,n={};for(var r in e)t=i(r),n[t]=u(t,e[r]);return n}var p=e("../methods"),_=e("../debug"),d=e("../../enumerations"),f=e("./label-rules"),h=["player_name","ns_st_ws","bbc_site","app_type","app_name","bbc_st_co","bbc_st_cdn","bbc_store_pf","bbc_store_ed","bbc_store_fr","bbc_store_src"],E={name:f.COUNTERNAME};E[d.ManagedLabels.EVENT_MASTER_BRAND]=f.EVENT_MASTER_BRAND;for(var g=0;g<h.length;g++)E[h[g]]=f.STRICT;return{cleanCounterName:a,cleanLabelKey:i,cleanLabelValue:u,cleanLanguage:c,cleanLabels:l}}),define("echo-8.0.0/util/cookies",[],function(){"use strict";var e={getCookieValueByName:function(e,t){var n=t||window;if("undefined"==typeof n.document||"string"!=typeof n.document.cookie)return null;for(var i=e+"=",r=n.document.cookie.split(";"),s=0,o=r.length;o>s;s++){var a=r[s];if(" "===a.charAt(0)&&(a=a.substring(1,a.length)),0===a.indexOf(i))return a.substring(i.length,a.length)}return null}};return e}),define("echo-8.0.0/util/cookie-policy",[],function(){"use strict";function e(e){if("string"!=typeof e)return!1;var t=e.match(/(0|1){3}/);return null!==t}var t=function(t){this._cookiePolicy=e(t)?t:null};return t.prototype.getBBCMcCookie=function(){if(null===this._cookiePolicy)return"";var e="ad"+this._cookiePolicy.charAt(0)+"ps"+this._cookiePolicy.charAt(1)+"pf"+this._cookiePolicy.charAt(2);return e},t.prototype.getCknsCookie=function(){return null===this._cookiePolicy?"":this._cookiePolicy},t.prototype.hasOptedOutOfAdvertisingCookies=function(){return null===this._cookiePolicy?!1:"0"===this._cookiePolicy.charAt(0)},t.prototype.hasOptedOutOfFunctionalityCookies=function(){return null===this._cookiePolicy?!1:"0"===this._cookiePolicy.charAt(1)},t.prototype.hasOptedOutOfPerformanceCookies=function(){return null===this._cookiePolicy?!1:"0"===this._cookiePolicy.charAt(2)},t}),define("echo-8.0.0/environment",["require","./util/cleansing/label-cleanser","./util/cookies","./util/cookie-policy"],function(e){"use strict";function t(){var e=window.screen||{},t=window.navigator||{},n=window.document||{};this._platformRuntimeEnvironment="html",this._platformOSVersion="5",this._screenResolution=(e.width||"-")+"x"+(e.height||"-"),this._language=t.language||"",this._platformName=t.platform||"",this._charset=n.characterSet||n.defaultCharset||"",this._title=n.title||"",this._url=n.URL||"",this._referrer=n.referrer||"",this._deviceName=null,this._httpGet=null,this._getCookie=null,this._setCookie=null;var s=i.getCookieValueByName("ckns_policy");this._cookiePolicy=new r(s)}var n=e("./util/cleansing/label-cleanser"),i=e("./util/cookies"),r=e("./util/cookie-policy");return t._defaultHttpGet=function(e,t){var n=new Image;"function"==typeof t&&(n.onload=function(){t()}),n.src=e},t._defaultGetCookie=function(e,t){return i.getCookieValueByName(e,t)},t.prototype.getCookiePolicy=function(){return this._cookiePolicy},t.prototype.getPlatformName=function(){return this._platformName},t.prototype.getPlatformRuntimeEnvironment=function(){return this._platformRuntimeEnvironment},t.prototype.getPlatformOSVersion=function(){return this._platformOSVersion},t.prototype.getDeviceName=function(){return this._deviceName},t.prototype.getScreenResolution=function(){return this._screenResolution},t.prototype.getLanguage=function(){return this._language},t.prototype.getHttpGet=function(){return this._httpGet},t.prototype.getCookieGetter=function(){return this._getCookie},t.prototype.getCookieSetter=function(){return this._setCookie},t.prototype.getCharSet=function(){return this._charset},t.prototype.getTitle=function(){return this._title},t.prototype.getURL=function(){return this._url},t.prototype.getReferrer=function(){return this._referrer},t.prototype.setPlatformName=function(e){return this._platformName=e,this},t.prototype.setPlatform=function(e,t){return this._platformRuntimeEnvironment=e,this._platformOSVersion=t,this},t.prototype.setDeviceName=function(e){return this._deviceName=e,this},t.prototype.setScreenResolution=function(e){return this._screenResolution=e,this},t.prototype.setLanguage=function(e){return this._language=n.cleanLanguage(e),this},t.prototype.setHttpGet=function(e){return this._httpGet=e,this},t.prototype.setCookieGetter=function(e){return this._getCookie=e,this},t.prototype.setCookieSetter=function(e){return this._setCookie=e,this},t.prototype.setCharSet=function(e){return this._charset=e,this},t.prototype.setTitle=function(e){return this._title=e,this},t.prototype.setURL=function(e){return this._url=e,this},t.prototype.setReferrer=function(e){return this._referrer=e,this},t}),define("echo-8.0.0/util/cleansing/label-validator.js",["require","../../enumerations"],function(e){"use strict";function t(e,t){switch(e){case n.ManagedLabels.IPLAYER_STATE:if("purchased"!==t&&"free"!==t)return!1;break;case n.ManagedLabels.STORE_ED_TYPE:if("archive"!==t&&"standard"!==t)return!1;break;case n.ManagedLabels.IPLAYER_AVAIL:if("avail"!==t&&"unavail"!==t&&"soon"!==t)return!1;break;case n.ManagedLabels.STORE_REFERRAL:if("iplayer"!==t&&"store"!==t)return!1;break;case n.ManagedLabels.BBC_HASHED_ID:if("string"!=typeof t||0===t.trim().length)return!1}return!0}var n=e("../../enumerations");return{isValidManagedLabel:t}}),function(e,t){return"function"==typeof define&&define.amd?define("sscHelper",t):("undefined"==typeof e.bbcssc&&(e.bbcssc={}),void(e.bbcssc.SSCHelper=t()))}(this,function(){function e(e){e=e||{},this.alwaysUseHttps=!0===e.alwaysUseHttps||!1,this.forceBBCHost=!1,this._sscCookieId=void 0,this._s1CookieId=void 0,".co.uk"===e.forceBBCHost?this.forceBBCHost=".co.uk":".com"===e.forceBBCHost&&(this.forceBBCHost=".com")}var t,n,i,r,s,o;return t="ckpf_sscid",n="s1",i="ssc.api.bbc.co.uk",r="ssc.api.bbc.com",s="b.scorecardresearch.com",o="sb.scorecardresearch.com",e.prototype.getCookie=function(e){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},e.prototype.getLocation=function(){return window.location},e.prototype.getCookieId=function(){var e,t,n,s;return t=this.getSSCHostname(),n=this.getLocation(),s=t===i&&-1!==n.hostname.search(/bbc.co.uk$/),(s||t===r&&-1!==n.hostname.search(/bbc.com$/))&&(e=this.getSSCCookieId(),!s||null!==e&&void 0!==e||(e=this.getS1CookieId())),e},e.prototype.getS1CookieId=function(){return void 0===this._s1CookieValue&&(this._s1CookieValue=this.getCookie(n)),this._s1CookieValue},e.prototype.getSSCCookieId=function(){return void 0===this._sscCookieValue&&(this._sscCookieValue=this.getCookie(t)),this._sscCookieValue},e.prototype.isValidId=function(e){var t;return t=!1,"string"==typeof e&&-1!==e.search(/^[^(?!<>\s)]+$/)&&(t=!0),t},e.prototype.getAnalyticsLocation=function(e,t){var n,i,r,s,o,a;return r=this.getSSCHostname(),i=this.getLocation(),n={sscId:void 0},"string"!=typeof e&&(e=""),(void 0===t||!1===this.isValidId(t))&&(t=this.getCookieId()),this.alwaysUseHttps||"https:"===i.protocol?n.protocol="https:":n.protocol="http:",o=-1!==e.search(/ns_alias=/),a=this.isValidId(t),o||a?n.hostname=this.getScorecardresearchHostname():n.hostname=this.getSSCHostname(),a&&(""===e?e="?ns_alias="+t:(s=e.search(/\?/)+1,e=[e.slice(0,s),"ns_alias="+t+"&",e.slice(s)].join("")),n.sscId=t),n.search=e,-1!==n.hostname.search(/scorecardresearch.com$/)?n.pathname="/p":n.pathname="/",n.href=n.protocol+"//"+n.hostname+n.pathname+n.search,n},e.prototype.getSSCHostname=function(){var e,t;return t=this.getLocation(),e=".com"===this.forceBBCHost||".co.uk"!==this.forceBBCHost&&-1===t.hostname.search(/bbc\.co\.uk$/)?r:i},e.prototype.getScorecardresearchHostname=function(){var e,t;return t=this.getLocation(),e="https:"===t.protocol?o:s},e}),define("echo-8.0.0/delegate/comscore/streamsense-bbc",[],function(){var e=e||{};return e.PlatformAPIs=e.PlatformAPIs||{Standard:0,Trilithium:1,AppleTV:2,Chromecast:3},e.Utils=e.Utils||function(){return{uid:function(){var e=1;return function(){return+new Date+"_"+e++}}(),filter:function(e,t){var n={};for(var i in t)t.hasOwnProperty(i)&&e(t[i])&&(n[i]=t[i]);return n},extend:function(e){var t,n=arguments.length;e=e||{};for(var i=1;n>i;i++)if(t=arguments[i])for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},getString:function(e,t){var n=String(e);return null==e?t||"na":n},getLong:function(e,t){var n=Number(e);return null==e||isNaN(n)?t||0:n},getInteger:function(e,t){var n=Number(e);return null==e||isNaN(n)?t||0:n},getBoolean:function(e,t){var n="true"==String(e).toLowerCase();return null==e?t||!1:n},isNotEmpty:function(e){return"undefined"!=typeof e&&null!=e&&"undefined"!=typeof e.length&&e.length>0},indexOf:function(e,t){var n=-1;return this.forEach(t,function(t,i){t==e&&(n=i)}),n},forEach:function(e,t,n){try{if("function"==typeof t)if(n="undefined"!=typeof n?n:null,"number"!=typeof e.length||"undefined"==typeof e[0]){var i="undefined"!=typeof e.__proto__;for(var r in e)e.hasOwnProperty(r)&&(!i||i&&"undefined"==typeof e.__proto__[r])&&"function"!=typeof e[r]&&t.call(n,e[r],r)}else for(var s=0,o=e.length;o>s;s++)t.call(n,e[s],s)}catch(a){}},regionMatches:function(e,t,n,i,r){if(0>t||0>i||t+r>e.length||i+r>n.length)return!1;for(;--r>=0;){var s=e.charAt(t++),o=n.charAt(i++);if(s!=o)return!1}return!0},size:function(e){var t=0;for(var n in e)e.hasOwnProperty(n)&&t++;return t},log:function(e,t){if("undefined"!=typeof t&&t&&"undefined"!=typeof console&&console){var n=new Date,i=n.getHours()+":"+n.getMinutes()+":"+n.getSeconds();console.log(i,e)}},isTrue:function(e){return"undefined"==typeof e?!1:"string"==typeof e?(e=e.toLowerCase(),"true"===e||"1"===e||"on"===e):!!e},toString:function(e){if("undefined"==typeof e)return"undefined";if("string"==typeof e)return e;if("[object Array]"===Object.prototype.toString.call(e))return e.join(",");if(this.size(e)>0){var t="";for(var n in e)e.hasOwnProperty(n)&&(t+=n+":"+e[n]+";");return t}return e.toString()},exists:function(e){return"undefined"!=typeof e&&null!=e},firstGreaterThan0:function(){for(var e=0,t=arguments.length;t>e;e++){var n=arguments[e];if(n>0)return n}return 0},cloneObject:function(e){if(null==e||"object"!=typeof e)return e;var t=function(){function e(){}function t(t){return"object"==typeof t?(e.prototype=t,new e):t}function n(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}function i(){this.copiedObjects=[];var e=this;this.recursiveDeepCopy=function(t){return e.deepCopy(t)},this.depth=0}function r(e,t){var n=new i;return t&&(n.maxDepth=t),n.deepCopy(e)}function s(e){return"undefined"!=typeof window&&window&&window.Node?e instanceof Node:e===document?!0:"number"==typeof e.nodeType&&e.attributes&&e.childNodes&&e.cloneNode}var o=[];return n.prototype={constructor:n,canCopy:function(){return!1},create:function(e){},populate:function(e,t,n){}},i.prototype={constructor:i,maxDepth:256,cacheResult:function(e,t){this.copiedObjects.push([e,t])},getCachedResult:function(e){for(var t=this.copiedObjects,n=t.length,i=0;n>i;i++)if(t[i][0]===e)return t[i][1]},deepCopy:function(e){if(null===e)return null;if("object"!=typeof e)return e;var t=this.getCachedResult(e);if(t)return t;for(var n=0;n<o.length;n++){var i=o[n];if(i.canCopy(e))return this.applyDeepCopier(i,e)}throw new Error("Unable to clone the following object "+e)},applyDeepCopier:function(e,t){var n=e.create(t);if(this.cacheResult(t,n),this.depth++,this.depth>this.maxDepth)throw new Error("Maximum recursion depth exceeded.");return e.populate(this.recursiveDeepCopy,t,n),this.depth--,n}},r.DeepCopier=n,r.deepCopiers=o,r.register=function(e){e instanceof n||(e=new n(e)),o.unshift(e)},r.register({canCopy:function(){return!0},create:function(e){return e instanceof e.constructor?t(e.constructor.prototype):{}},populate:function(e,t,n){for(var i in t)t.hasOwnProperty(i)&&(n[i]=e(t[i]));return n}}),r.register({canCopy:function(e){return e instanceof Array},create:function(e){return new e.constructor},populate:function(e,t,n){for(var i=0;i<t.length;i++)n.push(e(t[i]));return n}}),r.register({canCopy:function(e){return e instanceof Date},create:function(e){return new Date(e)}}),r.register({canCopy:function(e){return s(e)},create:function(e){return e===document?document:e.cloneNode(!1)},populate:function(e,t,n){if(t===document)return document;if(t.childNodes&&t.childNodes.length)for(var i=0;i<t.childNodes.length;i++){var r=e(t.childNodes[i]);n.appendChild(r)}}}),{deepCopy:r}}();return t.deepCopy(e)},safeGet:function(e,t){return t=this.exists(t)?t:"",this.exists(e)?e:t},getBrowserName:function(){if("undefined"==typeof navigator||!navigator.hasOwnProperty("userAgent")||!navigator.hasOwnProperty("appName"))return"";var e,t,n=navigator.userAgent,i=navigator.appName;return-1!=(t=n.indexOf("Opera"))||-1!=(t=n.indexOf("OPR/"))?i="Opera":-1!=(t=n.indexOf("Android"))?i="Android":-1!=(t=n.indexOf("Chrome"))?i="Chrome":-1!=(t=n.indexOf("Safari"))?i="Safari":-1!=(t=n.indexOf("Firefox"))?i="Firefox":-1!=(t=n.indexOf("IEMobile"))?i="Internet Explorer Mobile":"Microsoft Internet Explorer"==i||"Netscape"==i?i="Internet Explorer":(e=n.lastIndexOf(" ")+1)<(t=n.lastIndexOf("/"))&&(i=n.substring(e,t),i.toLowerCase()==i.toUpperCase()&&(i=navigator.appName)),i},getBrowserFullVersion:function(){if("undefined"==typeof navigator||!navigator.hasOwnProperty("userAgent")||!navigator.hasOwnProperty("appName")||!navigator.hasOwnProperty("appVersion"))return"";var e,t,n,i,r=navigator.userAgent,s=navigator.appName,o=""+parseFloat(navigator.appVersion);return-1!=(t=r.indexOf("Opera"))?(o=r.substring(t+6),-1!=(t=r.indexOf("Version"))&&(o=r.substring(t+8))):-1!=(t=r.indexOf("OPR/"))?o=r.substring(t+4):-1!=(t=r.indexOf("Android"))?o=r.substring(t+11):-1!=(t=r.indexOf("Chrome"))?o=r.substring(t+7):-1!=(t=r.indexOf("Safari"))?(o=r.substring(t+7),-1!=(t=r.indexOf("Version"))&&(o=r.substring(t+8))):-1!=(t=r.indexOf("Firefox"))?o=r.substring(t+8):"Microsoft Internet Explorer"==s?(i=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),null!=i.exec(r)&&(o=parseFloat(RegExp.$1))):"Netscape"==s?(i=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),null!=i.exec(r)&&(o=parseFloat(RegExp.$1))):r.lastIndexOf(" ")+1<(t=r.lastIndexOf("/"))&&(o=r.substring(t+1)),o=o.toString(),-1!=(n=o.indexOf(";"))&&(o=o.substring(0,n)),-1!=(n=o.indexOf(" "))&&(o=o.substring(0,n)),-1!=(n=o.indexOf(")"))&&(o=o.substring(0,n)),e=parseInt(""+o,10),isNaN(e)&&(o=""+parseFloat(navigator.appVersion)),o},browserAcceptsLargeURLs:function(){return"undefined"!=typeof window?null===window.ActiveXObject||!0:!0}}}(),e.StreamSense=e.StreamSense||function(){function t(e,t){var n=e||"",r="undefined",s=v.comScore||v.sitestat||function(e){var t,n,s,o,a,u="comScore=",c=m.cookie,l="",p="indexOf",_="substring",d="length",h=i.browserAcceptsLargeURLs()?A.URL_LENGTH_LIMIT:A.RESTRICTED_URL_LENGTH_LIMIT,E="&ns_",g="&",y=v.encodeURIComponent||escape;if(c[p](u)+1)for(o=0,s=c.split(";"),a=s[d];a>o;o++)n=s[o][p](u),n+1&&(l=g+unescape(s[o][_](n+u[d])));e+=E+"_t="+ +new Date+E+"c="+(m.characterSet||m.defaultCharset||"")+l,e.length>h&&e.indexOf(g)>0&&(t=e.substr(0,h-8).lastIndexOf(g),e=(e.substring(0,t)+E+"cut="+y(e.substring(t+1))).substr(0,h)),f.httpGet(e),typeof ns_p===r&&(ns_p={src:e}),ns_p.lastMeasurement=e};if(typeof t!==r){var o=[],a=v.encodeURIComponent||escape;for(var u in t)t.hasOwnProperty(u)&&o.push(a(u)+"="+a(t[u]));/[\?\&]$/.test(n)||(n+="&"),n+=o.join("&")}return s(n)}function n(e,t){for(var n,r=v.encodeURIComponent||escape,s=[],o=A.LABELS_ORDER,a=e.split("?"),u=a[0],c=a[1],l=c.split("&"),p=0,_=l.length;_>p;p++){var d=l[p].split("="),f=unescape(d[0]),h=unescape(d[1]);f&&(t[f]=h)}for(var E={},g=0,y=o.length;y>g;g++){var b=o[g];if(t.hasOwnProperty(b)){var I=t[b];"undefined"!=typeof I&&null!=I&&(E[b]=!0,s.push(r(b)+"="+r(t[b])))}}for(var C in t)if(t.hasOwnProperty(C)){if(E[C])continue;var S=t[C];"undefined"!=typeof S&&null!=S&&s.push(r(C)+"="+r(t[C]))}n=u+"?"+s.join("&"),n=n+(n.indexOf("&c8=")<0?"&c8="+r(m.title):"")+(n.indexOf("&c7=")<0?"&c7="+r(m.URL):"")+(n.indexOf("&c9=")<0?"&c9="+r(m.referrer):"");var L=i.browserAcceptsLargeURLs()?A.URL_LENGTH_LIMIT:A.RESTRICTED_URL_LENGTH_LIMIT;if(n.length>L&&n.indexOf("&")>0){var O=n.substr(0,L-8).lastIndexOf("&");n=(n.substring(0,O)+"&ns_cut="+r(n.substring(O+1))).substr(0,L)}return n}var i=e.Utils,r=function(){var e="cs_";return function(){var t="undefined"!=typeof localStorage?localStorage:{};i.extend(this,{get:function(n){return t[e+n]},set:function(n,i){t[e+n]=i},has:function(n){return e+n in t},remove:function(n){delete t[e+n]},clear:function(){for(var e in t)t.hasOwnProperty(e)&&delete t[e]}})}}(),s=function(){
var e="cs_",t=function(){var t="undefined"!=typeof atv&&"undefined"!=typeof atv.localStorage&&atv.localStorage||null;i.extend(this,{get:function(n){return t&&n&&t.getItem(e+n)||null},set:function(n,i){t&&n&&(t[e+n]=i)},has:function(n){return t&&n&&null!=t.getItem(e+n)||!1},remove:function(n){t&&n&&t.removeItem(e+n)},clear:function(){}})};return t}(),o=function(e,t){if("undefined"!=typeof Image){var n=new Image;n.onload=function(){t&&t(200),n=null},n.onerror=function(){t&&t(),n=null},n.src=e}},a=function(e,t,n){"undefined"!=typeof XMLHttpRequest&&n&&"undefined"!=typeof setTimeout&&setTimeout(n,0);var i=new XMLHttpRequest;i.open("POST",e,!0),i.onreadystatechange=function(){4===i.readyState&&(n&&n(i.status),i=null)},i.send(t)},u=function(e,t,n){n&&"undefined"!=typeof setTimeout&&setTimeout(n,0)},c=function(){function e(e){var t=u+e;p[t]="",_[t]=[]}function t(e,t){var n=u+e;p[n]+=d+o(t),_[n].push(t)}function n(e,t){var n=u+e,r=_[n];r.splice(i.indexOf(t,r),1);for(var s=[],a=0,c=r.length;c>a;a++)s.push(o(r[a]));p[n]=s.join(d),delete p[l+e+t]}function r(e,t,n){p[l+e+t]=n}function s(e,t){return p[l+e+t]}var o="undefined"!=typeof encodeURIComponent?encodeURIComponent:escape,a="undefined"!=typeof decodeURIComponent?decodeURIComponent:unescape,u="cs_dir_",l="cs_file_",p="undefined"!=typeof localStorage?localStorage:{},_={},d="|";return{dir:function(e){var t=u+e,n=_[t];if(n)return n.slice();var i=p[t];if(i){i=i.split(d),n=[];for(var r=0,s=i.length;s>r;r++)i[r].length>0&&n.push(a(i[r]));return _[t]=n,n.slice()}return null},append:function(e,t,n){var i=c.read(e,t);i?i+=n:i=n,c.write(e,t,i)},write:function(n,s,o){var a=c.dir(n);a||(e(n),a=[]),-1==i.indexOf(s,a)&&t(n,s),r(n,s,o)},deleteFile:function(e,t){var r=c.dir(e);return r?-1==i.indexOf(t,r)?!1:(n(e,t),!0):!1},read:function(e,t){var n=c.dir(e);return n?-1==i.indexOf(t,n)?null:s(e,t):null}}}(),l=function(){return{dir:function(){return null},append:function(e,t,n){},write:function(e,t,n){},deleteFile:function(){return!1},read:function(){return null}}}(),p=function(e,t){"undefined"!=typeof engine&&t&&"undefined"!=typeof setTimeout&&setTimeout(t,0);var n=engine.createHttpClient(),i=n.createRequest("GET",e,null);i.start(),t&&setTimeout(t,0)},_=function(e,t){if("undefined"!=typeof atv&&"function"==typeof atv.setTimeout){"undefined"!=typeof XMLHttpRequest&&t&&atv.setTimeout(t,0);var n=new XMLHttpRequest;n.open("GET",e,!0),n.onreadystatechange=function(){4===n.readyState&&(t&&t(n.status),n=null)},n.send()}},d=function(e,t,n){if("undefined"!=typeof atv&&"function"==typeof atv.setTimeout){"undefined"!=typeof XMLHttpRequest&&n&&atv.setTimeout(n,0);var i=new XMLHttpRequest;i.open("POST",e,!0),i.onreadystatechange=function(){4===i.readyState&&(n&&n(i.status),i=null)},i.send(t)}},f=function(){return{PLATFORM:"generic",httpGet:o,httpPost:u,Storage:r,IO:l,getCrossPublisherId:function(){return null},getAppName:function(){return Constants.UNKNOWN_VALUE},getAppVersion:function(){return Constants.UNKNOWN_VALUE},getVisitorId:function(){return this.getDeviceName()+ +new Date+~~(1e3*Math.random())},getVisitorIdSuffix:function(){return"72"},getDeviceName:function(){return""},getPlatformVersion:function(){return""},getPlatformName:function(){return"js"},getRuntimeName:function(){return""},getRuntimeVersion:function(){return""},getResolution:function(){return""},getLanguage:function(){return""},getPackageName:function(){return""},isConnectionAvailable:function(){return!0},isCompatible:function(){return!0},autoSelect:function(){},setPlatformAPI:function(){},isCrossPublisherIdChanged:function(){return!1},setTimeout:function(e,t,n){return setTimeout(e,t,n)},clearTimeout:function(e){return clearTimeout(e)},getDeviceArchitecture:function(){return Constants.UNKNOWN_VALUE},getConnectionType:function(){return Constants.UNKNOWN_VALUE},getDeviceJailBrokenFlag:function(){return Constants.UNKNOWN_VALUE}}}(),h=function(){function e(){return"undefined"!=typeof engine&&"undefined"!=typeof engine.stats}function t(){return i.isNotEmpty(engine.stats.device.id)?engine.stats.device.id:i.isNotEmpty(engine.stats.network.mac)?engine.stats.network.mac:null}function n(){if(null==s){var e=t();null!=e?(s=e,o="31",a=e):(s=+new Date+~~(1e3*Math.random()),o="72",a=null)}}var s=null,o=null,a=null;return{PLATFORM:"trilithium",httpGet:p,httpPost:u,Storage:r,IO:l,getCrossPublisherId:function(){return n(),a},getAppName:function(){return i.isNotEmpty(engine.stats.application.name)?engine.stats.application.name:Constants.UNKNOWN_VALUE},getAppVersion:function(){return i.isNotEmpty(engine.stats.application.version)?engine.stats.application.version:Constants.UNKNOWN_VALUE},getVisitorId:function(){return n(),s},getVisitorIdSuffix:function(){return o},getDeviceName:function(){return i.safeGet(engine.stats.device.platform,"")},getPlatformVersion:function(){return i.safeGet(engine.stats.device.version,"")},getPlatformName:function(){return"js"},getRuntimeName:function(){return"trilithium"},getRuntimeVersion:function(){return""},getResolution:function(){return"undefined"!=typeof screen&&"undefined"!=typeof screen.height&&"undefined"!=typeof screen.width?screen.height+"x"+screen.width:""},getLanguage:function(){return""},getPackageName:function(){return""},isConnectionAvailable:function(){return!0},isCompatible:e}}(),E=function(){function e(){return"undefined"==typeof window&&"undefined"!=typeof atv}function t(){null==n&&("undefined"!=typeof atv&&"undefined"!=typeof atv.device&&atv.device.idForVendor?(n=i.safeGet(atv.device.idForVendor,""),r="62"):(n=+new Date+~~(1e3*Math.random()),r="72"),o=null)}var n=null,r=null,o=null;return{PLATFORM:"atv",httpGet:_,httpPost:d,Storage:s,IO:l,getCrossPublisherId:function(){return t(),o},getAppName:function(){return Constants.UNKNOWN_VALUE},getAppVersion:function(){return Constants.UNKNOWN_VALUE},getVisitorId:function(){return t(),n},getVisitorIdSuffix:function(){return r},getDeviceName:function(){return"Apple TV"},getPlatformVersion:function(){return"undefined"!=typeof atv&&"undefined"!=typeof atv.device&&i.safeGet(atv.device.softwareVersion,"")},getPlatformName:function(){return"js"},getRuntimeName:function(){return"atv"},getRuntimeVersion:function(){return"undefined"!=typeof atv&&"undefined"!=typeof atv.device&&i.safeGet(atv.device.softwareVersion,"")},getResolution:function(){return"undefined"!=typeof atv.device&&"undefined"!=typeof atv.device.screenFrame&&"undefined"!=typeof atv.device.screenFrame.height&&"undefined"!=typeof atv.device.screenFrame.width?atv.device.screenFrame.height+"x"+atv.device.screenFrame.width:""},getLanguage:function(){return"undefined"!=typeof atv&&"undefined"!=typeof atv.device&&i.safeGet(atv.device.language,"")},getPackageName:function(){return""},isConnectionAvailable:function(){return!0},setTimeout:function(e,t,n){return"undefined"!=typeof atv&&"undefined"!=typeof atv.setTimeout&&atv.setTimeout(e,t,n)},clearTimeout:function(e){return"undefined"!=typeof atv&&"undefined"!=typeof atv.clearTimeout&&atv.clearTimeout(e)},isCompatible:e}}(),g=function(){function e(){return"undefined"!=typeof window&&"undefined"!=typeof document}return{PLATFORM:"chromecast",httpGet:o,httpPost:a,Storage:r,IO:c,getCrossPublisherId:function(){return null},getAppName:function(){return"undefined"!=typeof document&&document.title||Constants.UNKNOWN_VALUE},getAppVersion:function(){return Constants.UNKNOWN_VALUE},getVisitorId:function(){return+new Date+~~(1e3*Math.random())},getVisitorIdSuffix:function(){return"72"},getDeviceName:function(){return"chromecast"},getPlatformVersion:function(){return"5"},getPlatformName:function(){return"js"},getRuntimeName:function(){return"html"},getRuntimeVersion:function(){return i.safeGet(i.getBrowserName()+" "+i.getBrowserFullVersion(),Constants.UNKNOWN_VALUE)},getResolution:function(){var e="undefined"!=typeof window&&i.exists(window.screen)&&i.exists(window.screen.availWidth)?window.screen.availWidth:0,t="undefined"!=typeof window&&i.exists(window.screen)&&i.exists(window.screen.availHeight)?window.screen.availHeight:0;return e>0&&t>0?e+"x"+t:""},getLanguage:function(){return"undefined"!=typeof window&&i.exists(window.navigator)&&i.safeGet(window.navigator.language,"")||""},getPackageName:function(){return"undefined"!=typeof castReceiverManager&&castReceiverManager.getApplicationData&&"function"==typeof castReceiverManager.getApplicationData&&castReceiverManager.getApplicationData().namespaces&&castReceiverManager.getApplicationData().namespaces[0]||""},isConnectionAvailable:function(){return"undefined"!=typeof window&&i.exists(window.navigator)&&i.safeGet(window.navigator.onLine,!0)||!0},isCompatible:e,getConnectionType:function(){return Constants.UNKNOWN_VALUE}}}();f.autoSelect=function(){h.isCompatible()?e.Utils.extend(f,h):E.isCompatible()&&e.Utils.extend(f,E)},f.setPlatformAPI=function(t){var n=!1;switch(t){case e.PlatformAPIs.Trilithium:e.Utils.extend(f,h),n=!0;break;case e.PlatformAPIs.AppleTV:e.Utils.extend(f,E),n=!0;break;case e.PlatformAPIs.Chromecast:i.extend(f,g),n=!0}n&&(f.autoSelect=function(){})};var v,m,y="undefined"!=typeof window&&"undefined"!=typeof document;y?(v=window,m=document):(v={},m={location:{href:""},title:"",URL:"",referrer:"",cookie:""});var i=i||{};i.filterMap=function(e,t){for(var n in e)e.hasOwnProperty(n)&&-1==i.indexOf(n,t)&&delete e[n]},i.getKeys=function(e,t){var n,i=[];for(n in e)(!t||t.test(n))&&e.hasOwnProperty(n)&&(i[i.length]=n);return i};var b=function(){var e=["play","pause","end","buffer","keep-alive","hb","custom","ad_play","ad_pause","ad_end","ad_click"];return{PLAY:0,PAUSE:1,END:2,BUFFER:3,KEEP_ALIVE:4,HEART_BEAT:5,CUSTOM:6,AD_PLAY:7,AD_PAUSE:8,AD_END:9,AD_CLICK:10,toString:function(t){return e[t]}}}(),I=function(){var e=[b.END,b.PLAY,b.PAUSE,b.BUFFER];return{IDLE:0,PLAYING:1,PAUSED:2,BUFFERING:3,toEventType:function(t){return e[t]}}}(),C={ADPLAY:b.AD_PLAY,ADPAUSE:b.AD_PAUSE,ADEND:b.AD_END,ADCLICK:b.AD_CLICK},A={STREAMSENSE_VERSION:"4.1505.18",DEFAULT_PLAYERNAME:"streamsense",DEFAULT_HEARTBEAT_INTERVAL:[{playingtime:6e4,interval:1e4},{playingtime:null,interval:6e4}],DEFAULT_KEEP_ALIVE_INTERVAL:12e5,DEFAULT_PAUSED_ON_BUFFERING_INTERVAL:500,C1_VALUE:"19",C10_VALUE:"js",NS_AP_C12M_VALUE:"1",NS_NC_VALUE:"1",PAGE_NAME_LABEL:"name",RESTRICTED_URL_LENGTH_LIMIT:2048,URL_LENGTH_LIMIT:4096,LABELS_ORDER:["c1","c2","ca2","cb2","cc2","cd2","ns_site","ca_ns_site","cb_ns_site","cc_ns_site","cd_ns_site","ns_vsite","ca_ns_vsite","cb_ns_vsite","cc_ns_vsite","cd_ns_vsite","ns_ap_an","ca_ns_ap_an","cb_ns_ap_an","cc_ns_ap_an","cd_ns_ap_an","ns_ap_pn","ns_ap_pv","c12","ca12","cb12","cc12","cd12","ns_ak","ns_ap_hw","name","ns_ap_ni","ns_ap_ec","ns_ap_ev","ns_ap_device","ns_ap_id","ns_ap_csf","ns_ap_bi","ns_ap_pfm","ns_ap_pfv","ns_ap_ver","ca_ns_ap_ver","cb_ns_ap_ver","cc_ns_ap_ver","cd_ns_ap_ver","ns_ap_sv","ns_ap_cv","ns_type","ca_ns_type","cb_ns_type","cc_ns_type","cd_ns_type","ns_radio","ns_nc","ns_ap_ui","ca_ns_ap_ui","cb_ns_ap_ui","cc_ns_ap_ui","cd_ns_ap_ui","ns_ap_gs","ns_st_sv","ns_st_pv","ns_st_it","ns_st_id","ns_st_ec","ns_st_sp","ns_st_sq","ns_st_cn","ns_st_ev","ns_st_po","ns_st_cl","ns_st_el","ns_st_pb","ns_st_hc","ns_st_mp","ca_ns_st_mp","cb_ns_st_mp","cc_ns_st_mp","cd_ns_st_mp","ns_st_mv","ca_ns_st_mv","cb_ns_st_mv","cc_ns_st_mv","cd_ns_st_mv","ns_st_pn","ns_st_tp","ns_st_pt","ns_st_pa","ns_st_ad","ns_st_li","ns_st_ci","ns_ap_jb","ns_ap_res","ns_ap_sd","ns_ap_po","ns_ap_ot","ns_ap_c12m","cs_c12u","ns_ap_install","ns_ap_updated","ns_ap_lastrun","ns_ap_cs","ns_ap_runs","ns_ap_usage","ns_ap_fg","ns_ap_ft","ns_ap_dft","ns_ap_bt","ns_ap_dbt","ns_ap_dit","ns_ap_as","ns_ap_das","ns_ap_it","ns_ap_uc","ns_ap_aus","ns_ap_daus","ns_ap_us","ns_ap_dus","ns_ap_ut","ns_ap_oc","ns_ap_uxc","ns_ap_uxs","ns_ap_lang","ns_ap_ar","ns_ap_miss","ns_ts","ns_st_ca","ns_st_cp","ns_st_er","ca_ns_st_er","cb_ns_st_er","cc_ns_st_er","cd_ns_st_er","ns_st_pe","ns_st_ui","ca_ns_st_ui","cb_ns_st_ui","cc_ns_st_ui","cd_ns_st_ui","ns_st_bc","ns_st_bt","ns_st_bp","ns_st_pc","ns_st_pp","ns_st_br","ns_st_ub","ns_st_vo","ns_st_ws","ns_st_pl","ns_st_pr","ns_st_ep","ns_st_ty","ns_st_ct","ns_st_cs","ns_st_ge","ns_st_st","ns_st_dt","ns_st_de","ns_st_pu","ns_st_cu","ns_st_fee","ns_ap_i1","ns_ap_i2","ns_ap_i3","ns_ap_i4","ns_ap_i5","ns_ap_i6","ns_ap_referrer","ns_clid","ns_campaign","ns_source","ns_mchannel","ns_linkname","ns_fee","gclid","utm_campaign","utm_source","utm_medium","utm_term","utm_content","c3","ca3","cb3","cc3","cd3","c4","ca4","cb4","cc4","cd4","c5","ca5","cb5","cc5","cd5","c6","ca6","cb6","cc6","cd6","c10","c11","c13","c14","c15","c16","c7","c8","c9","ns_ap_er"]},S=function(){return function(){function e(e,t){var i=t[e];null!=i&&(n[e]=i)}var t,n,r=this,s=0,o=0,a=0,u=0,c=0,l=0;i.extend(this,{reset:function(e){null!=e&&e.length>0?i.filterMap(n,e):n={},n.hasOwnProperty("ns_st_cl")||(n.ns_st_cl="0"),n.hasOwnProperty("ns_st_pn")||(n.ns_st_pn="1"),n.hasOwnProperty("ns_st_tp")||(n.ns_st_tp="1"),r.setPauses(0),r.setStarts(0),r.setBufferingTime(0),r.setBufferingTimestamp(-1),r.setPlaybackTime(0),r.setPlaybackTimestamp(-1)},setLabels:function(e,t){null!=e&&i.extend(n,e),r.setRegisters(n,t)},getLabels:function(){return n},setLabel:function(e,t){var n={};n[e]=t,r.setLabels(n,null)},getLabel:function(e){return n[e]},getClipId:function(){return("undefined"==typeof t||null==t)&&r.setClipId("1"),t},setClipId:function(e){t=e},setRegisters:function(t,n){var i=t.ns_st_cn;null!=i&&(r.setClipId(i),delete t.ns_st_cn),i=t.ns_st_bt,null!=i&&(a=Number(i),delete t.ns_st_bt),e("ns_st_cl",t),e("ns_st_pn",t),e("ns_st_tp",t),e("ns_st_ub",t),e("ns_st_br",t),(n==I.PLAYING||null==n)&&(i=t.ns_st_sq,null!=i&&(o=Number(i),delete t.ns_st_sq)),n!=I.BUFFERING&&(i=t.ns_st_pt,null!=i&&(c=Number(i),delete t.ns_st_pt)),(n==I.PAUSED||n==I.IDLE||null==n)&&(i=t.ns_st_pc,null!=i&&(s=Number(i),delete t.ns_st_pc))},createLabels:function(e,t){var n=t||{};return n.ns_st_cn=r.getClipId(),n.ns_st_bt=String(r.getBufferingTime()),(e==b.PLAY||null==e)&&(n.ns_st_sq=String(o)),(e==b.PAUSE||e==b.END||e==b.KEEP_ALIVE||e==b.HEART_BEAT||null==e)&&(n.ns_st_pt=String(r.getPlaybackTime()),n.ns_st_pc=String(s)),i.extend(n,r.getLabels()),n},incrementPauses:function(){s++},incrementStarts:function(){o++},getBufferingTime:function(){var e=a;return u>=0&&(e+=+new Date-u),e},setBufferingTime:function(e){a=e},getPlaybackTime:function(){var e=c;return l>=0&&(e+=+new Date-l),e},setPlaybackTime:function(e){c=e},getPlaybackTimestamp:function(){return l},setPlaybackTimestamp:function(e){l=e},getBufferingTimestamp:function(){return u},setBufferingTimestamp:function(e){u=e},getPauses:function(){return s},setPauses:function(e){s=e},getStarts:function(){return o},setStarts:function(e){o=e}}),n={},r.reset()}}(),L=function(){return function(){var e,t,n=this,r=null,s=0,o=0,a=0,u=0,c=0,l=0,p=!1;i.extend(this,{reset:function(e){null!=e&&e.length>0?i.filterMap(t,e):t={},n.setPlaylistId(+new Date+"_"+l),n.setBufferingTime(0),n.setPlaybackTime(0),n.setPauses(0),n.setStarts(0),n.setRebufferCount(0),p=!1},setLabels:function(e,r){null!=e&&i.extend(t,e),n.setRegisters(t,r)},getLabels:function(){return t},setLabel:function(e,t){var i={};i[e]=t,n.setLabels(i,null)},getLabel:function(e){return t[e]},getClip:function(){return r},getPlaylistId:function(){return e},setPlaylistId:function(t){e=t},setRegisters:function(t,n){var i=t.ns_st_sp;null!=i&&(s=Number(i),delete t.ns_st_sp),i=t.ns_st_bc,null!=i&&(a=Number(i),delete t.ns_st_bc),i=t.ns_st_bp,null!=i&&(u=Number(i),delete t.ns_st_bp),i=t.ns_st_id,null!=i&&(e=i,delete t.ns_st_id),n!=I.BUFFERING&&(i=t.ns_st_pa,null!=i&&(c=Number(i),delete t.ns_st_pa)),(n==I.PAUSED||n==I.IDLE||null==n)&&(i=t.ns_st_pp,null!=i&&(o=Number(i),delete t.ns_st_pp))},createLabels:function(t,r){var u=r||{};return u.ns_st_bp=String(n.getBufferingTime()),u.ns_st_sp=String(s),u.ns_st_id=String(e),a>0&&(u.ns_st_bc=String(a)),(t==b.PAUSE||t==b.END||t==b.KEEP_ALIVE||t==b.HEART_BEAT||null==t)&&(u.ns_st_pa=String(n.getPlaybackTime()),u.ns_st_pp=String(o)),(t==b.PLAY||null==t)&&(n.didFirstPlayOccurred()||(u.ns_st_pb="1",n.setFirstPlayOccurred(!0))),i.extend(u,n.getLabels()),u},incrementStarts:function(){s++},incrementPauses:function(){o++,r.incrementPauses()},setPlaylistCounter:function(e){l=e},incrementPlaylistCounter:function(){l++},addPlaybackTime:function(e){if(r.getPlaybackTimestamp()>=0){var t=e-r.getPlaybackTimestamp();r.setPlaybackTimestamp(-1),r.setPlaybackTime(r.getPlaybackTime()+t),n.setPlaybackTime(n.getPlaybackTime()+t)}},addBufferingTime:function(e){if(r.getBufferingTimestamp()>=0){var t=e-r.getBufferingTimestamp();r.setBufferingTimestamp(-1),r.setBufferingTime(r.getBufferingTime()+t),n.setBufferingTime(n.getBufferingTime()+t)}},getBufferingTime:function(){var e=u;return r.getBufferingTimestamp()>=0&&(e+=+new Date-r.getBufferingTimestamp()),e},setBufferingTime:function(e){u=e},getPlaybackTime:function(){var e=c;return r.getPlaybackTimestamp()>=0&&(e+=+new Date-r.getPlaybackTimestamp()),e},setPlaybackTime:function(e){c=e},getStarts:function(){return s},setStarts:function(e){s=e},getPauses:function(){return o},setPauses:function(e){o=e},getRebufferCount:function(){return a},incrementRebufferCount:function(){a++},setRebufferCount:function(e){a=e},didFirstPlayOccurred:function(){return p},setFirstPlayOccurred:function(e){p=e}}),r=new S,t={},n.reset()}}(),O=function(){var r=function(r,s,o){function a(e){var t=0;if(null!=de)for(var n=0;n<de.length;n++){var i=de[n],r=i.playingtime;if(!r||r>e){t=i.interval;break}}return t}function u(){_();var e=a(pe.getClip().getPlaybackTime());if(e>0){var t=Ee>0?Ee:e;Q=f.setTimeout(p,t)}Ee=0}function c(){_();var e=a(pe.getClip().getPlaybackTime());Ee=e-pe.getClip().getPlaybackTime()%e,null!=Q&&_()}function l(){Ee=0,ve=0,ge=0}function p(){ge++;var e=G(b.HEART_BEAT,null);P(e),Ee=0,u()}function _(){null!=Q&&(f.clearTimeout(Q),Q=null)}function d(){E(),Z=f.setTimeout(h,fe)}function h(){var e=G(b.KEEP_ALIVE,null);P(e),le++,d()}function E(){null!=Z&&(f.clearTimeout(Z),Z=null)}function g(){m(),se.isPauseOnBufferingEnabled()&&V(I.PAUSED)&&(J=f.setTimeout(v,he))}function v(){if(ee==I.PLAYING){pe.incrementRebufferCount(),pe.incrementPauses();var e=G(b.PAUSE,null);P(e),le++,ee=I.PAUSED}}function m(){null!=J&&(f.clearTimeout(J),J=null)}function y(e){return e==I.PLAYING||e==I.PAUSED}function C(){K&&(f.clearTimeout(K),K=null)}function S(e){return e==b.PLAY?I.PLAYING:e==b.PAUSE?I.PAUSED:e==b.BUFFER?I.BUFFERING:e==b.END?I.IDLE:null}function O(e,t,n){if(C(),n)K=f.setTimeout(function(e,t){return function(){O(e,t)}}(e,t),n);else if(U(e)){var r=x(),s=ue,o=B(t),a=s>=0?o-s:0;M(x(),t),D(e,t),H(x()),k(e);for(var u=0,c=re.length;c>u;u++)re[u](r,e,t,a);T(t),pe.setRegisters(t,e),pe.getClip().setRegisters(t,e);var l=G(I.toEventType(e),t);i.extend(l,t),V(X)&&(P(l),ee=X,le++)}}function T(e){var t=e.ns_st_mp;null!=t&&(te=t,delete e.ns_st_mp),t=e.ns_st_mv,null!=t&&(ne=t,delete e.ns_st_mv),t=e.ns_st_ec,null!=t&&(le=Number(t),delete e.ns_st_ec)}function P(e,t){void 0===t&&(t=!0),t&&N(e);var i=se.getPixelURL();if(z){if(!R()){var r=ye.am,s=ye.et,o=r.newApplicationMeasurement(z,s.HIDDEN,e,i);z.getQueue().offer(o)}}else i&&f.httpGet(n(i,e))}function R(){var e=z.getAppContext(),t=z.getSalt(),n=z.getPixelURL();return null==e||null==t||0==t.length||null==n||0==n.length}function N(e){ie=G(null),i.extend(ie,e)}function M(e,t){var n=B(t);if(e==I.PLAYING)pe.addPlaybackTime(n),c(),E();else if(e==I.BUFFERING)pe.addBufferingTime(n),m();else if(e==I.IDLE){var r=i.getKeys(pe.getClip().getLabels());pe.getClip().reset(r)}}function D(e,t){var n=B(t);ce=w(t),e==I.PLAYING?(u(),d(),pe.getClip().setPlaybackTimestamp(n),V(e)&&(pe.getClip().incrementStarts(),pe.getStarts()<1&&pe.setStarts(1))):e==I.PAUSED?V(e)&&pe.incrementPauses():e==I.BUFFERING?(pe.getClip().setBufferingTimestamp(n),_e&&g()):e==I.IDLE&&l()}function V(e){return e!=I.PAUSED&&e!=I.IDLE||ee!=I.IDLE&&null!=ee?e!=I.BUFFERING&&ee!=e:!1}function w(e){var t=-1;return e.hasOwnProperty("ns_st_po")&&(t=i.getInteger(e.ns_st_po)),t}function B(e){var t=-1;return e.hasOwnProperty("ns_ts")&&(t=Number(e.ns_ts)),t}function U(e){return null!=e&&x()!=e}function k(e){X=e,ue=+new Date}function x(){return X}function H(e){$=e}function G(){var e,t;1==arguments.length?(e=I.toEventType(X),t=arguments[0]):(e=arguments[0],t=arguments[1]);var n={};if("undefined"!=typeof document){var r=document;n.c7=r.URL,n.c8=r.title,n.c9=r.referrer}return null!=t&&i.extend(n,t),n.hasOwnProperty("ns_ts")||(n.ns_ts=String(+new Date)),null!=e&&!n.hasOwnProperty("ns_st_ev")&&(n.ns_st_ev=b.toString(e)),i.extend(n,se.getLabels()),F(e,n),pe.createLabels(e,n),pe.getClip().createLabels(e,n),n.hasOwnProperty("ns_st_mp")||(n.ns_st_mp=te),n.hasOwnProperty("ns_st_mv")||(n.ns_st_mv=ne),n.hasOwnProperty("ns_st_ub")||(n.ns_st_ub="0"),n.hasOwnProperty("ns_st_br")||(n.ns_st_br="0"),n.hasOwnProperty("ns_st_pn")||(n.ns_st_pn="1"),n.hasOwnProperty("ns_st_tp")||(n.ns_st_tp="1"),n.hasOwnProperty("ns_st_it")||(n.ns_st_it="c"),n.ns_st_sv=A.STREAMSENSE_VERSION,n.ns_type="hidden",n}function F(e,t){var n=t||{};if(n.ns_st_ec=String(le),!n.hasOwnProperty("ns_st_po")){var r=ce,s=B(n);(e==b.PLAY||e==b.KEEP_ALIVE||e==b.HEART_BEAT||null==e&&X==I.PLAYING)&&(r+=s-pe.getClip().getPlaybackTimestamp()),n.ns_st_po=i.getInteger(r)}return e==b.HEART_BEAT&&(n.ns_st_hc=String(ge)),n}function j(e){var t=B(e);0>t&&(e.ns_ts=String(+new Date))}function Y(e,t,n){t=t||{},t.ns_st_ad=1,e>=b.AD_PLAY&&e<=b.AD_CLICK&&se.notify(e,t,n)}function W(e,t){se.notify(b.CUSTOM,e,t)}var q,K,$,X,z,J,Z,Q,ee,te,ne,ie,re,se=this,oe=500,ae=null,ue=0,ce=0,le=0,pe=null,_e=!0,de=A.DEFAULT_HEARTBEAT_INTERVAL,fe=A.DEFAULT_KEEP_ALIVE_INTERVAL,he=A.DEFAULT_PAUSED_ON_BUFFERING_INTERVAL,Ee=0,ge=0,ve=0,me=!1,ye={};o?f.setPlatformAPI(o):f.autoSelect(),i.extend(this,{reset:function(e){pe.reset(e),pe.setPlaylistCounter(0),pe.setPlaylistId(+new Date+"_1"),pe.getClip().reset(e),null==e||e.isEmpty()?q={}:i.filterMap(q,e),le=1,ge=0,c(),l(),E(),m(),C(),X=I.IDLE,$=null,ue=-1,ee=null,te=A.DEFAULT_PLAYERNAME,ne=A.STREAMSENSE_VERSION,ie=null},setPauseOnBufferingInterval:function(e){he=e},getPauseOnBufferingInterval:function(){return he},setKeepAliveInterval:function(e){fe=e},getKeepAliveInterval:function(){return fe},setHeartbeatIntervals:function(e){de=e},notify:function(){var e,t,n,r;if(t=arguments[0],3==arguments.length?(n=arguments[1],r=arguments[2]):(n={},r=arguments[1]),b.toString(t)){e=S(t);var s=i.extend({},n);if(j(s),s.hasOwnProperty("ns_st_po")||(s.ns_st_po=i.getInteger(r).toString()),t==b.PLAY||t==b.PAUSE||t==b.BUFFER||t==b.END)se.isThrottlingEnabled()&&y(X)&&y(e)&&(X!=I.PLAYING||e!=I.PAUSED||K)?O(e,s,oe):O(e,s);else{var o=G(t,s);i.extend(o,s),P(o,!1),le++}}},getLabels:function(){return q},getState:function(){return X},setLabels:function(e){for(var t in e)e.hasOwnProperty(t)&&se.setLabel(t,e[t])},getLabel:function(e){return q[e]},setLabel:function(e,t){null==t?delete q[e]:q[e]=t},setPixelURL:function(e){if(null==e||0==e.length)return null;var t=decodeURIComponent||unescape,n=e.indexOf("?");if(n>=0){if(n<e.length-1){for(var i=e.substring(n+1).split("&"),r=0,s=i.length;s>r;r++){var o=i[r],a=o.split("=");2==a.length?se.setLabel(a[0],t(a[1])):1==a.length&&se.setLabel(A.PAGE_NAME_LABEL,t(a[0]))}e=e.substring(0,n+1)}}else e+="?";return ae=e},getPixelURL:function(){return ae?ae:"undefined"!=typeof ns_p&&"string"==typeof ns_p.src?ae=ns_p.src.replace(/&amp;/,"&").replace(/&ns__t=\d+/,""):"string"==typeof ns_pixelUrl?ae=ns_pixelUrl.replace(/&amp;/,"&").replace(/&ns__t=\d+/,""):null},isPauseOnBufferingEnabled:function(){return _e},setPauseOnBufferingEnabled:function(e){_e=e},isThrottlingEnabled:function(){return me},setThrottlingEnabled:function(e){me=e},setThrottlingDelay:function(e){e&&e>0&&(oe=e)},getThrottlingDelay:function(){return oe},setClip:function(e,t){var n=!1;return X==I.IDLE&&(pe.getClip().reset(),pe.getClip().setLabels(e,null),t&&pe.incrementStarts(),n=!0),n},setPlaylist:function(e){var t=!1;return X==I.IDLE&&(pe.incrementPlaylistCounter(),pe.reset(),pe.getClip().reset(),pe.setLabels(e,null),t=!0),t},importState:function(e){reset();var t=i.extend({},e);pe.setRegisters(t,null),pe.getClip().setRegisters(t,null),T(t),le++},exportState:function(){return ie},getVersion:function(){return A.STREAMSENSE_VERSION},addListener:function(e){re.push(e)},removeListener:function(e){re.splice(i.indexOf(e,re),1)},getClip:function(){return pe.getClip()},getPlaylist:function(){return pe},setHttpGet:function(e){"function"==typeof e&&(f.httpGet=e)},setHttpPost:function(e){"function"==typeof e&&(f.httpPost=e)}}),i.extend(this,{adNotify:Y,customNotify:W,viewNotify:function(e,n){e=e||se.getPixelURL(),e&&t(e,n)}}),e.comScore&&(ye=e.comScore.exports,z=ye.c()),q={},le=1,X=I.IDLE,pe=new L,J=null,_e=!0,Q=null,ge=0,l(),Z=null,K=null,me=!1,ee=null,ce=0,re=[],se.reset(),r&&se.setLabels(r),s&&se.setPixelURL(s)};return function(t){function n(e,t){return C[S]||s(e,t)}function r(){S=-1;for(var t=0;A>=t;t++)if(C.hasOwnProperty(String(t))){S=t;break}return e.StreamSense.activeIndex=S,S}function s(t,n){return t=t||null,n=n||null,t&&"object"==typeof t&&(n=t,t=null),C[++A]=new e.StreamSense(n,t),r(),C[A]}function o(){var t=!1,n=S;if("number"==typeof arguments[0]&&isFinite(arguments[0]))n=arguments[0];else if(arguments[0]instanceof e.StreamSense)for(var i in C)if(C.hasOwnProperty(i)&&C[i]===arguments[0]){n=i;break}return C.hasOwnProperty(String(n))&&(t=C[n],delete C[n],t.reset(),r()),t}function a(e){return e=e||{},n().setPlaylist(e),n().getPlaylist()}function u(e,t,i){return e=e||{},"number"==typeof t&&(e.ns_st_cn=t),n().setClip(e,i),n().getClip()}function c(e,t,i){return"undefined"==typeof e?!1:(i=i||null,t=t||{},n().notify(e,t,i))}function l(e){"undefined"!=typeof e&&n().setLabels(e)}function p(){return n().getLabels()}function _(e){"undefined"!=typeof e&&n().getPlaylist().setLabels(e)}function d(){return n().getPlaylist().getLabels()}function f(e){"undefined"!=typeof e&&n().getClip().setLabels(e)}function h(){return n().getClip().getLabels()}function E(e){return n().reset(e||{})}function g(e){return n().getPlaylist().reset(e||{})}function v(e){return n().getClip().reset(e||{})}function m(e){return e=e||{},n().viewNotify(null,e)}function y(e,t){return arguments.length>2&&(e=arguments[1],t=arguments[2]),e=e||{},"number"==typeof t&&(e.ns_st_po=t),n().customNotify(e,t)}function b(){return n().exportState()}function I(e){n().importState(e)}var C={},A=-1,S=-1;i.extend(t,{activeIndex:S,newInstance:s,"new":s,destroyInstance:o,destroy:o,newPlaylist:a,newClip:u,notify:c,setLabels:l,getLabels:p,setPlaylistLabels:_,getPlaylistLabels:d,setClipLabels:f,getClipLabels:h,resetInstance:E,resetPlaylist:g,resetClip:v,viewEvent:m,customEvent:y,exportState:b,importState:I})}(r),r}();return O.AdEvents=C,O.PlayerEvents=b,O.InternalStates=I,O.getPlatformAPI=function(){return f},O}(),e.StreamingTag=e.StreamingTag||function(){var t=e.Utils,n=e.StreamSense,i=e.StreamSense.PlayerEvents,r=(e.StreamSense.AdEvents,e.StreamSense.InternalStates||null),s=null!=e.StreamSense.InternalStates;return function(){var o=function(o){function a(){if(s)if(e.comScore)b=new n,b.setLabel("ns_st_it","r");else if(t.exists(o))if(I=t.isTrue(o.debug),t.exists(o.customerC2)&&o.customerC2.length>0){var i=o.secure?"https://sb":"http"+("s"==document.location.href.charAt(4)?"s://sb":"://b");b=new n,b.setPixelURL(i+".scorecardresearch.com/p?c1=2"),b.setLabel("c2",o.customerC2),b.setLabel("ns_st_it","r")}else I&&console&&console.log("Warning: customerC2 is not provided (or incorrect) in the StreamingTag configuration.")}function u(e){return t.exists(e)||(e={}),t.exists(e.ns_st_ci)||(e.ns_st_ci="0"),t.exists(e.c3)||(e.c3="*null"),t.exists(e.c4)||(e.c4="*null"),t.exists(e.c6)||(e.c6="*null"),e}function c(e){return g>0&&e>=g?v+=e-g:v=0,v}function l(e){b.getState()!=r.IDLE&&b.getState()!=r.PAUSED?b.notify(i.END,c(e)):b.getState()==r.PAUSED&&b.notify(i.END,v)}function p(e){return _("ns_st_ci",m,e)&&_("c3",m,e)&&_("c4",m,e)&&_("c6",m,e)}function _(e,n,i){if(t.exists(e)&&t.exists(n)&&t.exists(i)){var r=n[e],s=i[e];return t.exists(r)&&t.exists(s)&&r===s}return!1}function d(e,n){l(e),E++;var r={ns_st_cn:E,ns_st_pn:"1",ns_st_tp:"0"};t.extend(r,n),b.setClip(r),m=n,g=e,v=0,b.notify(i.PLAY,v)}function f(e){var n=+new Date;l(n),E++,e=u(e);var r={ns_st_cn:E,ns_st_pn:"1",ns_st_tp:"1",ns_st_ad:"1"};t.extend(r,e),b.setClip(r),v=0,b.notify(i.PLAY,v),g=n,y=!1}function h(e,t){var n=+new Date;e=u(e),A==C.None&&(A=t),y&&A==t&&p(e)?(b.getClip().setLabels(e),b.getState()!=r.PLAYING&&(g=n,b.notify(i.PLAY,v))):d(n,e),y=!0,A=t}var E=0,g=0,v=0,m=null,y=!1,b=null,I=!1,C={None:0,AudioContent:1,VideoContent:2},A=C.None;t.extend(this,{playAdvertisement:function(){if(b){I&&console&&console.warn("Calling deprecated function 'playAdvertisement'. Please call 'playVideoAdvertisement' or 'playAudioAdvertisement' functions instead.");var e={ns_st_ct:"va"};f(e)}},playVideoAdvertisement:function(e){if(b){var n={ns_st_ct:"va"};e&&t.extend(n,e),f(n)}},playAudioAdvertisement:function(e){if(b){var n={ns_st_ct:"aa"};e&&t.extend(n,e),f(n)}},playContentPart:function(e){if(b){I&&console&&console.warn("Calling deprecated function 'playContentPart'. Please call 'playVideoContentPart' or 'playAudioContentPart' functions instead.");var n={ns_st_ct:"vc"};e&&t.extend(n,e),h(n,C.VideoContent)}},playVideoContentPart:function(e){if(b){var n={ns_st_ct:"vc"};e&&t.extend(n,e),h(n,C.VideoContent)}},playAudioContentPart:function(e){if(b){var n={ns_st_ct:"ac"};e&&t.extend(n,e),h(n,C.AudioContent)}},stop:function(){if(b){var e=+new Date;b.notify(i.PAUSE,c(e))}}}),a()};return function(e){}(o),o}()}(),e.StreamSense}),define("echo-8.0.0/delegate/comscore/app-tag",["./label-keys"],function(e){"use strict";function t(e,n,i,r){this._persistantLabels={},this._url=t._makeBaseUrl(e),this._urlParams="",this._cut="",this._httpGet=n,this._eventCount=0,this._isApp=i,this._isScorecardDomain=r===!0}return t.URL_LIMIT=2048,t.prototype.addLabels=function(e){for(var t in e)this._persistantLabels[t]=e[t]},t.prototype.addLabel=function(e,t){this._persistantLabels[e]=t},t.prototype.removeLabels=function(e){for(var t in e)"undefined"!=typeof this._persistantLabels[e[t]]&&delete this._persistantLabels[e[t]]},t.prototype.removeLabel=function(e){"undefined"!=typeof this._persistantLabels[e]&&delete this._persistantLabels[e]},t.prototype.send=function(e,t,n){var i,r,s=this._persistantLabels,o={};this._eventCount++;for(r in s)o[r]=s[r];for(r in t)o[r]=t[r];o.ns_type=e,this._isApp&&(o.ns_ap_ev=e,o.ns_ap_ec=this._eventCount),o[this._isApp?"ns_ts":"ns__t"]=+new Date,i=this._createUrl(o),this._httpGet(i,n)},t.prototype._createUrl=function(t){var n,i=window.encodeURIComponent||escape,r=this._url;this._urlParams="",this._cut="",t.hasOwnProperty("name")&&this._addUrlParam("name",t.name);for(n in t)"name"!==n&&"ns_referrer"!==n&&this._addUrlParam(n,t[n]);return t.hasOwnProperty("ns_referrer")&&this._addUrlParam(this._isScorecardDomain?e.ENV_REFERRER:"ns_referrer",t.ns_referrer),r+=this._urlParams,this._cut.length?r+="ns_cut="+i(this._cut.replace(/&$/,"")):r=r.replace(/&$/,""),r},t.prototype._addUrlParam=function(e,n){var i=window.encodeURIComponent||escape,r=i(e)+"="+i(n)+"&",s=t.URL_LIMIT-8;this._url.length+this._urlParams.length+r.length<s?this._urlParams+=r:this._cut+=r},t._makeBaseUrl=function(e){for(var t=-1,n=e.charAt(e.length-1),i=0,r=e.length;r>i;i++)"?"===e.charAt(i)&&(t=i);return-1===t?e+="?":"?"!==n&&"&"!==n&&(e+="&"),e},t}),define("echo-8.0.0/delegate/comscore/comscore-delegate",["require","./label-keys","../../config/keys","../../environment","../../util/methods","../../util/cleansing/label-validator.js","../../enumerations","sscHelper","./streamsense-bbc","./app-tag"],function(e){"use strict";function t(){return-1}function n(e,t,i,r){var s,o,a,u,p;i[E.REPORTING_PROFILE]&&(u=c(i[E.REPORTING_PROFILE]),p=u?u.sscHost:null),p=i[E.SSC_HOSTNAME]||p,this._playerDelegate=null,this.media=null,this.SSPlayerEvent=n.StreamSense.PlayerEvents,this.SSPlayerState=n.StreamSense.InternalStates,this.useSsc=i[E.USE_SSC]===!0,s=i[E.ECHO_DEVICE_ID]||void 0,this.useSsc!==!0||s||(a=n._createSscHelper({
forceBBCHost:p}),s=a.getCookieId()),v.containsValue(y.ApplicationType,t)||(t=b);var m=f(r.getURL()),I=l("http:"),C=i[E.COMSCORE_SITE];u&&(I=_(u.comscoreHost,m,C)),i.hasOwnProperty(E.COMSCORE_HOST)&&(I=_(i[E.COMSCORE_HOST],m,C)),this.useSsc!==!0||s||(I=a.getLocation().protocol+"//"+a.getSSCHostname());var A=I;i[E.TEST_SERVICE_ENABLED]===!0&&(I=i[E.TEST_SERVICE_URL]+"/comscore"),this._isApp=!v.containsValue(S,t);var L=r.getHttpGet(),O=!d(I);if(this.appTag=new n.AppTag(I,L||g._defaultHttpGet,this._isApp,O),this.ss=new n.StreamSense({},I),L&&this.ss.setHttpGet(L),s&&(o=this.useSsc?h.COMSCORE_ALIAS:h.DEVICE_ID,this.appTag.addLabel(o,s),this.ss.setLabel(o,s)),i[E.TEST_SERVICE_ENABLED]===!0&&this.addLabel(h.COMSCORE_ENDPOINT,A),this.addLabel(h.BBC_APPLICATION_NAME,e),this.addLabel(h.BBC_APPLICATION_TYPE,t),this.addLabel(h.BBC_MEASUREMENT_LIB_NAME,i[E.ECHO_NAME]),this.addLabel(h.BBC_MEASUREMENT_LIB_VERSION,i[E.ECHO_VERSION]),this._isApp?(this.addLabel(h.APP_NAME,e),this.addLabel(h.APP_PLATFORM_NAME,r.getPlatformName()),this.addLabel(h.APP_PLATFORM_RUNTIME,r.getPlatformRuntimeEnvironment()),this.addLabel(h.APP_OS_VERSION,r.getPlatformOSVersion()),this.addLabel(h.APP_DEVICE_NAME,r.getDeviceName()),this.addLabel(h.APP_SCREEN_RESOLUTION,r.getScreenResolution()),this.addLabel(h.APP_LANGUAGE,r.getLanguage())):this.addLabel(h.WEB_SCREEN_RES,r.getScreenResolution()),this.addLabel(h.ENV_CHAR_SET,r.getCharSet()),this.addLabel(h.ENV_TITLE,r.getTitle()),this.addLabel(h.ENV_URL,r.getURL()),this.addLabel(h.ENV_REFERRER,r.getReferrer()),i[E.ECHO_TRACE]&&this.setTraceId(i[E.ECHO_TRACE]),i[E.COMSCORE_SITE]&&this.addLabel(h.COMSCORE_SITE,i[E.COMSCORE_SITE]),u&&(i.hasOwnProperty(E.COMSCORE_CUSTOMER_ID)||(i[E.COMSCORE_CUSTOMER_ID]=u.customerId),O)){var T=i[E.COMSCORE_CUSTOMER_ID];this.addLabel(h.COMSCORE_CUSTOMER,T)}var P=r.getCookiePolicy(),R=P.getBBCMcCookie();R.length>0&&(this.addLabel(h.COOKIE_POLICY,R),P.hasOptedOutOfPerformanceCookies()&&this.addLabel(h.NO_COOKIES,"1")),this.addLabel(y.ManagedLabels.BBC_SITE,b),this._mediaIsLive=null}function i(e){var t={},n=a(e);return t[h.PLAYLIST_CLIP_COUNT]=1,t[h.PLAYLIST_NAME]=null===n?b:n.getValue(),t[h.PLAYLIST_LENGTH]=e.getLength(),t}function r(e){var t={},n=a(e),i=s(e.getAvType()),r=s(e.getLength()),c=s(e.getRetrievalType()),l=e.getBitrate(),p=e.getScheduleMode(),_=e.getCodec(),d=e.getCDN();t[h.MEDIA_CLIP_NUMBER]=1,t[h.MEDIA_PART_NUMBER]=1,t[h.MEDIA_TOTAL_PARTS]=1,t[h.MEDIA_LENGTH]=r,t[h.MEDIA_MEDIUM]=i,t[h.MEDIA_RETRIEVAL_TYPE]=c;var f=e.getMediaConsumptionMode();null===f?(t[h.MEDIA_STREAM_TYPE]=b,t[h.MEDIA_LIVE_OR_ONDEMAND]=b):e.isLive()||i!==b?e.isOnDemand()||e.isDownload()?(t[h.MEDIA_STREAM_TYPE]=e.isVideo()?"vod":"aod",t[h.MEDIA_LIVE_OR_ONDEMAND]="on-demand"):(t[h.MEDIA_STREAM_TYPE]="live",t[h.MEDIA_IS_LIVE]=1,t[h.MEDIA_LIVE_OR_ONDEMAND]="live"):t[h.MEDIA_STREAM_TYPE]=b,l>0&&(t[h.MEDIA_BITRATE]=1e3*l),null!==p&&(t[h.MEDIA_SCHEDULE_INDICATOR]=p),null!==_&&(t[h.MEDIA_CODEC]=_),null!==d&&(t[h.MEDIA_CDN]=d);var E=e.getVersionIdObject(),g=e.getServiceIdObject(),v=e.getClipIdObject(),m=e.getEpisodeIdObject();return t[h.MEDIA_PID]=o(n),E.isValueSet()&&(t[h.MEDIA_VERSION_ID]=o(E)),g.isValueSet()&&(t[h.MEDIA_SERVICE_ID]=o(g)),v.isValueSet()&&(t[h.MEDIA_CLIP_ID]=o(v)),m.isValueSet()&&(t[h.MEDIA_EPISODE_ID]=o(m)),u(e)&&(t[h.MEDIA_AMBIGUOUS_ID]="1"),t}function s(e){var t=null===e?b:e;return t}function o(e){return null!==e&&e.isValueValid()?e.getValue():b}function a(e){var t=e.getMediaConsumptionMode(),n=e.getServiceIdObject(),i=e.getVersionIdObject(),r=e.getClipIdObject(),s=e.getEpisodeIdObject(),o=e.getVpIdObject();return t===y.MediaConsumptionMode.LIVE&&n.isValueValid()?n:i.isValueValid()?i:r.isValueValid()?r:s.isValueValid()?s:o.isValueValid()?o:n.isValueValid()?n:null}function u(e){var t=a(e),n=e.getMediaConsumptionMode(),i=e.getVersionIdObject(),r=e.getEpisodeIdObject(),s=e.getClipIdObject();if(null!==t){var o=t.getIdType();if(o===y.MediaIdType.SERVICE&&n===y.MediaConsumptionMode.LIVE)return!1;if(!(o!==y.MediaIdType.SERVICE||i.isValueSet()||r.isValueSet()||s.isValueSet()))return!0;if(o!==y.MediaIdType.VPID)return!1}return!0}function c(e){return e=e.toUpperCase(),y.ReportingProfiles.hasOwnProperty(e)?y.ReportingProfiles[e]:null}function l(e){var t="https:"===e?"s":"";return e+"//"+t+"b."+A+"/p?"}function p(e,t){return e+"//"+C+"/"+t+"/s"}function _(e,t,n){return e===A?l(t):p(t,n)}function d(e){return e.indexOf(C)>-1}function f(e){return-1===e.indexOf("https:",0)?"http:":"https:"}var h=e("./label-keys"),E=e("../../config/keys"),g=e("../../environment"),v=e("../../util/methods"),m=e("../../util/cleansing/label-validator.js"),y=e("../../enumerations"),b="invalid-data",I=e("sscHelper"),C="sa.bbc.co.uk/bbc",A="scorecardresearch.com",S=[y.ApplicationType.WEB,y.ApplicationType.MOBILE_WEB,y.ApplicationType.RESPONSIVE],L=[h.NO_COOKIES,h.DEVICE_ID];n.prototype.setTraceId=function(e){this.addLabel(E.ECHO_TRACE,e)},n._createSscHelper=function(e){return new I(e||{})},n.StreamSense=e("./streamsense-bbc"),n.AppTag=e("./app-tag");var O="<"+L.join("><")+">";return n.prototype._isExcludedLabel=function(e){return this.useSsc===!0?!!O.match(new RegExp("<"+e+">")):!1},n.prototype.addLabels=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&!this._isExcludedLabel(n)&&(t[n]=e[n]);this.appTag.addLabels(t),this.ss.setLabels(t)},n.prototype.addLabel=function(e,t){this._isExcludedLabel(e)!==!0&&(this.appTag.addLabel(e,t),this.ss.setLabel(e,t))},n.prototype.addManagedLabel=function(e,t){var n=m.isValidManagedLabel(e,t),i=n?t:b;for(var r in y.ManagedLabels)y.ManagedLabels[r]===e&&this.addLabel(e,i)},n.prototype.removeLabels=function(e){this.appTag.removeLabels(e);for(var t=0,n=e.length;n>t;t++)this.ss.setLabel(e[t],null)},n.prototype.removeLabel=function(e){this.appTag.removeLabel(e),this.ss.setLabel(e,null)},n.prototype.setLoggedInToBBCId=function(e){this.addLabel(h.BBC_ID_LOGGED_IN,"1"),e&&this.addManagedLabel(y.ManagedLabels.BBC_HASHED_ID,e)},n.prototype.setLoggedOutOfBBCId=function(){this.removeLabels([h.BBC_ID_LOGGED_IN,y.ManagedLabels.BBC_HASHED_ID])},n.prototype.setAppVersion=function(e){this._isApp&&this.addLabel(h.APP_VERSION,e)},n.prototype.setCounterName=function(e){this.addLabel(h.BBC_COUNTER_NAME,e)},n.prototype.setContentLanguage=function(e){this.addLabel(h.BBC_LANGUAGE,e)},n.prototype.viewEvent=function(e,t){this.addLabel(h.BBC_COUNTER_NAME,e);var n=v.extend(t,!0,h.ECHO_EVENT_NAME,"view");this.appTag.send("view",n)},n.prototype.errorEvent=t,n.prototype.userActionEvent=function(e,t,n){var i=v.extend(n,!0,h.USER_ACTION_TYPE,e,h.USER_ACTION_NAME,t,h.ECHO_EVENT_NAME,"userAct");this.appTag.send("hidden",i)},n.prototype.setPlayerName=function(e){this.addLabel(h.PLAYER_NAME,e)},n.prototype.setPlayerVersion=function(e){this.addLabel(h.PLAYER_VERSION,e)},n.prototype.setPlayerIsPopped=function(e){this.ss.setLabel(h.PLAYER_POPPED,e?1:0)},n.prototype.setPlayerWindowState=function(e){this.ss.setLabel(h.PLAYER_WINDOW_STATE,e)},n.prototype.setPlayerVolume=function(e){this.ss.setLabel(h.PLAYER_VOLUME,e)},n.prototype.setPlayerIsSubtitled=function(e){this.ss.setLabel(h.PLAYER_SUBTITLED,e?1:0)},n.prototype.setPlayerDelegate=function(e){return this._playerDelegate=e,this},n.prototype.setMedia=function(e){this.clearMedia(),this.media=e;var t=r(this.media),n=i(this.media);this._mediaIsLive=!e.isOnDemand(),this.ss.setPlaylist(n),this.ss.setClip(t)},n.prototype.setMediaLength=function(e){e>=0&&null!==this.media&&(this.media.isLive()||(this.ss.getPlaylist().setLabel(h.PLAYLIST_LENGTH,e),this.ss.getClip().setLabel(h.MEDIA_LENGTH,e)))},n.prototype.setMediaBitrate=function(e){e>0&&null!==this.media&&(e*=1e3,this.ss.getClip().setLabel(h.MEDIA_BITRATE,e))},n.prototype.setMediaCodec=function(e){this.ss.getClip().setLabel(h.MEDIA_CODEC,e)},n.prototype.setMediaCDN=function(e){this.ss.getClip().setLabel(h.MEDIA_CDN,e)},n.prototype.avPlayEvent=function(e,t){var n=v.extend(t,!0,h.ECHO_EVENT_NAME,"avPlay");this.ss.notify(this.SSPlayerEvent.PLAY,n,this._mediaIsLive?0:e)},n.prototype.avPauseEvent=function(e,t){var n=v.extend(t,!0,h.ECHO_EVENT_NAME,"avPause");this.ss.notify(this.SSPlayerEvent.PAUSE,n,this._mediaIsLive?0:e)},n.prototype.avBufferEvent=function(e,t){this.ss.notify(this.SSPlayerEvent.BUFFER,{},this._mediaIsLive?0:e)},n.prototype.avEndEvent=function(e,t){var n=v.extend(t,!0,h.ECHO_EVENT_NAME,"avEnd",h.PLAYLIST_END,1);this.ss.notify(this.SSPlayerEvent.END,n,this._mediaIsLive?0:e),this.clearMedia()},n.prototype.avRewindEvent=function(e,t,n){var i=v.extend(n,!0,h.ECHO_EVENT_NAME,"avRW",h.EVENT_TRIGGERED_BY_USER,"rewind",h.REWIND_FF_RATE,t);this.ss.notify(this.SSPlayerEvent.PAUSE,i,this._mediaIsLive?0:e)},n.prototype.avFastForwardEvent=function(e,t,n){var i=v.extend(n,!0,h.ECHO_EVENT_NAME,"avFF",h.EVENT_TRIGGERED_BY_USER,"fastforward",h.REWIND_FF_RATE,t);this.ss.notify(this.SSPlayerEvent.PAUSE,i,this._mediaIsLive?0:e)},n.prototype.avSeekEvent=function(e,t){var n=v.extend(t,!0,h.ECHO_EVENT_NAME,"avSeek",h.EVENT_TRIGGERED_BY_USER,"seek");this.ss.notify(this.SSPlayerEvent.PAUSE,n,this._mediaIsLive?0:e)},n.prototype.avUserActionEvent=function(e,t,n,i){var r=v.extend(i,!0,h.ECHO_EVENT_NAME,"avUserAct",h.STREAMSENSE_CUSTOM_EVENT_TYPE,e,h.USER_ACTION_TYPE,e,h.USER_ACTION_NAME,t);this.ss.customNotify(r,this._mediaIsLive?0:n)},n.prototype.clearMedia=function(){null!==this.media&&(this.ss.getState()===this.SSPlayerState.PLAYING&&this.avEndEvent(0),this.media=null)},n}),define("echo-8.0.0/delegate/rum/label-keys",{COUNTERNAME:"cn",USER_ACTION_TYPE:"uat",USER_ACTION_NAME:"uan",USER_ACTION_EVENT:"UA",MEDIA_PID:"pid",MEDIA_TYPE:"mt",MEDIA_ON_DEMAND:"od",MEDIA_RETRIEVAL_TYPE:"ret",MEDIA_LENGTH:"len",MEDIA_BITRATE:"br",MEDIA_CDN:"cdn",MEDIA_CODEC:"codec",MEDIA_POSITION:"pos",AV_PLAY_EVENT:"AVPL",AV_PAUSE_EVENT:"AVPS",AV_BUFFER_EVENT:"AVBF",AV_END_EVENT:"AVEN",AV_FF_EVENT:"AVFF",AV_RW_EVENT:"AVRW",AV_SEEK_EVENT:"AVSK",AV_UA_EVENT:"AVUA",ECHO_TRACE:"trace"}),define("lib/json",["require"],function(e){var t={};return function(){function e(e){return 10>e?"0"+e:e}function n(e){return o.lastIndex=0,o.test(e)?'"'+e.replace(o,function(e){var t=a[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function i(e,t){var o,a,u,c,l,p=r,_=t[e];switch(_&&"object"==typeof _&&"function"==typeof _.toJSON&&(_=_.toJSON(e)),typeof _){case"string":return n(_);case"number":return isFinite(_)?String(_):"null";case"boolean":case"null":return String(_);case"object":if(!_)return"null";if(r+=s,l=[],"[object Array]"===Object.prototype.toString.apply(_)){for(c=_.length,o=0;c>o;o+=1)l[o]=i(o,_)||"null";return u=0===l.length?"[]":r?"[\n"+r+l.join(",\n"+r)+"\n"+p+"]":"["+l.join(",")+"]",r=p,u}for(a in _)Object.prototype.hasOwnProperty.call(_,a)&&(u=i(a,_),u&&l.push(n(a)+(r?": ":":")+u));return u=0===l.length?"{}":r?"{\n"+r+l.join(",\n"+r)+"\n"+p+"}":"{"+l.join(",")+"}",r=p,u}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var r,s,o=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,a={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};"function"!=typeof t.stringify&&(t.stringify=function(e){return i("",{"":e})})}(),t}),define("analytics_client",["require","./lib/json"],function(e){function t(n){this.events=[],this.labels={},this.dataLabels={},this._getCookie=n.custom_cookie_getter||this._getCookie,this.p=n.product||"_",this.e=n.edition||null,this.id2=this._getCookie(t.USER_COOKIE_NAME),this.posting=this._setDelivery(n.delivery_method,n.server,n.url_params,n.custom_delivery),this.limit_url=!this.posting,this.JSON=window.JSON||e("./lib/json")}return t.USER_COOKIE_NAME="s1",t.MAX_URL_LENGTH=2e3,t.RT_THRESHOLD=6e4,t.AJAX_POST=1,t.AJAX_GET=2,t.DOM_GET=3,t.CUSTOM_POST=4,t.CUSTOM_GET=5,t.LABELS={COUNT_CONTENT_ID:"ccid",COUNT_LIST_ID:"clid"},t.VERSION="0.4.5",t.prototype._setDelivery=function(e,n,i,r){var s,o,a;switch(e){case t.AJAX_POST:s=!0,o=!0,a=!1;break;case t.AJAX_GET:s=!1,o=!0,a=!1;break;case t.DOM_GET:s=!1,o=!1,a=!1;break;case t.CUSTOM_POST:s=!0,o=!1,a=!0;break;case t.CUSTOM_GET:s=!1,o=!1,a=!0;break;default:s=!0,o=!0,a=!1}return s&&"object"==typeof navigator&&navigator.platform&&(-1!=navigator.platform.indexOf("iPhone")||-1!=navigator.platform.indexOf("iPod")||-1!=navigator.platform.indexOf("iPad"))&&(s=!1),a?this._makeRequest=t._useCustomRequest(r,t._makeURL(s,n,i),s):o&&"undefined"!=typeof XMLHttpRequest&&"undefined"!=typeof(new XMLHttpRequest).withCredentials?this._makeRequest=t._useXMLHttpRequest(t._makeURL(s,n,i),s):(s=!1,this._makeRequest=t._useImageRequest(t._makeURL(!1,n,i))),s},t._makeURL=function(e,n,i){var r=e?"":"/legacy",s=n+r;return i?t._addParams(s,i):s},t._addParams=function(e,t){-1===e.indexOf("?")?e+="?":e.indexOf("?")!==e.length-1&&(e+="&");for(var n in t)e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n])+"&";return e.replace(/(\?|&)$/,"")},t.prototype._addEvent=function(e,n,i){var r,s,o={},a={};for(r in this.dataLabels)o[r]=this.dataLabels[r];for(r in n)o[r]=n[r];for(r in this.labels)a[r]=this.labels[r];for(r in i)r===t.LABELS.COUNT_CONTENT_ID||r===t.LABELS.COUNT_LIST_ID?o[r]=i[r]:a[r]=i[r];s={cv:t.VERSION,p:this.p,id:e,id2:this.id2,ts:(new Date).getTime(),l:a,data:o},null!==this.e&&(s.e=this.e),this.events.push(s)},t.prototype._getCookie=function(e){if("undefined"==typeof document||"string"!=typeof document.cookie)return null;var t,n=document.cookie;if(0===n.indexOf(e+"="))t=e.length+1;else{if(t=n.indexOf(" "+e+"="),-1==t)return null;t+=e.length+2}var i=n.indexOf(";",t);return-1==i&&(i=n.length),n.substring(t,i)},t.prototype._addEventAndSend=function(e,t,n,i){this._addEvent(e,t,n),this._sendEvents(i)},t._createPLData=function(){return{url:window.location.pathname,referrer:document.referrer}},t._createPTData=function(){if("object"!=typeof window.performance)return null;var e={url:window.location.pathname};for(var t in window.performance.timing)"function"!=typeof window.performance.timing[t]&&(e[t]=window.performance.timing[t]);e.navigationStart=e.navigationStart||e.redirectStart||e.fetchStart;var n=e.loadEventEnd,i=e.navigationStart,r=e.requestStart,s=e.responseEnd;return n&&i&&r&&s&&(e.plt=n-i,e.pre=r-i,e.req=s-r,e.pro=n-s),e},t._createRTData=function(e,n){if(window.performance&&window.performance.getEntriesByType){var i=t._cleanRTData(window.performance.getEntriesByType("resource"));return{url:window.location.pathname,plt:e,"long":n,res:i}}return null},t._cleanRTData=function(e){for(var t=[],n=0,i=e.length;i>n;n++){t[n]={};for(var r in e[n])0!==e[n][r]&&("name"===r?t[n][r]=e[n][r].replace(/\?.*$/,""):t[n][r]=e[n][r])}return t},t.prototype._sendEvents=function(e,n){var i,r,s=n;if(s||(s=this.events,this.events=[]),i=this.JSON.stringify({events:s}),this.limit_url&&s.length>1&&i.length>t.MAX_URL_LENGTH)for(r=0;r<s.length;r++)this._sendEvents(e,[s[r]]);else this._makeRequest(e,i,{"Content-type":"application/json"})},t._useXMLHttpRequest=function(e,n){return function(i,r,s){var o,a=e;n||(a=t._addParams(a,{data:r})),o=new XMLHttpRequest,o.open(n?"POST":"GET",a,!0);for(var u in s)o.setRequestHeader(u,s[u]);o.onreadystatechange=function(){4==o.readyState&&i&&i(o.status)};try{o.send(r)}catch(c){}}},t._useImageRequest=function(e){function n(e,t){s.push(function(){var n=new Image;n.onload=function(){i(),"function"==typeof e&&e()},n.onerror=function(){i()},n.onabort=function(){i()},n.src=t}),r()}function i(){o=!1,r()}function r(){if(!(o||s.length<1)){o=!0;var e=s.shift();e()}}var s=[],o=!1;return function(i,r){var s=t._addParams(e,{data:r});n(i,s)}},t._useCustomRequest=function(e,n,i){return i?function(t,i,r){e(t,null,"POST",n,r,i)}:function(i,r,s){e(i,null,"GET",t._addParams(n,{data:r}),s)}},t.prototype.load=function(e,n){var i=this;i._addEvent("PL",t._createPLData(),e),setTimeout(function(){var r,s,o,a=t._createPTData();a&&(i._addEvent("PT",a,e),n!==!1&&(s=a.plt,o=a.plt>t.RT_THRESHOLD,(n||o)&&(r=t._createRTData(a.plt,o),r&&(i.rtSent=!0,i._addEvent("RT",r,e))))),i._sendEvents()},0)},t.prototype.sendError=function(e,t,n,i){this._addEventAndSend("ERR",{m:e,file:t,line:n},i)},t.prototype.sendExit=function(e,t,n){this._addEventAndSend("EXIT",{s:e,d:t},n)},t.prototype.addLabels=function(e,t){for(var n in e)this.addLabel(n,e[n],t)},t.prototype.addLabel=function(e,t,n){this[n?"dataLabels":"labels"][e]=t},t.prototype.removeLabels=function(e){for(var t=0;t<e.length;t++)delete this.labels[e[t]]},{AC:t}}),define("echo-8.0.0/delegate/rum/rum-delegate",["require","./label-keys","../../config/keys","../../util/methods","analytics_client"],function(e){"use strict";function t(){return-1}function n(e,t,i,o){i[s.TEST_SERVICE_ENABLED]===!0&&(i[s.RUM_URL]=i[s.TEST_SERVICE_URL]+"/rum");var a={server:i[s.RUM_URL],product:e},u=o.getHttpGet();u&&(a.delivery_method=n.AC.CUSTOM_GET,a.custom_delivery=function(e,t,n,i,r){u(i,r,e,t)}),o.getCookieGetter()&&(a.custom_cookie_getter=o.getCookieGetter()),o.getCookieSetter()&&(a.custom_cookie_setter=o.getCookieSetter()),this.ac=new n.AC(a),i[s.ECHO_TRACE]&&this.ac.addLabel(r.ECHO_TRACE,i[s.ECHO_TRACE],!0)}function i(e){var t=e.getClipIdObject(),n=e.getEpisodeIdObject();return t.isValueValid()?t:n.isValueValid()?n:null}var r=e("./label-keys"),s=e("../../config/keys"),o=e("../../util/methods");return n.AC=e("analytics_client").AC,n.prototype.addLabels=function(e){this.ac.addLabels(e)},n.prototype.addLabel=function(e,t){this.ac.addLabel(e,t)},n.prototype.addManagedLabel=t,n.prototype.setTraceId=t,n.prototype.removeLabels=function(e){this.ac.removeLabels(e)},n.prototype.removeLabel=function(e){this.ac.removeLabels([e])},n.prototype.setCounterName=function(e){this.ac.addLabel(r.COUNTERNAME,e,!0)},n.prototype.setLoggedInToBBCId=t,n.prototype.setLoggedOutOfBBCId=t,n.prototype.setAppVersion=t,n.prototype.setContentLanguage=t,n.prototype.setPlayerDelegate=t,n.prototype.viewEvent=function(e,t){this.ac.addLabel(r.COUNTERNAME,e,!0),this.ac.load(t)},n.prototype.errorEvent=function(e,t){var n=e.name+": "+e.message;this.ac.sendError(n,"",null,t)},n.prototype.userActionEvent=function(e,t,n){var i=o.extend({},!1,r.USER_ACTION_TYPE,e,r.USER_ACTION_NAME,t);this.ac._addEventAndSend(r.USER_ACTION_EVENT,i,n)},n.prototype.setPlayerName=t,n.prototype.setPlayerVersion=t,n.prototype.setPlayerIsPopped=t,n.prototype.setPlayerWindowState=t,n.prototype.setPlayerVolume=t,n.prototype.setPlayerIsSubtitled=t,n.prototype.setPlayerPositionGetter=t,n.prototype.clearMedia=t,n.prototype.setMedia=function(e){this._mediaLabels={},o.extend(this._mediaLabels,!1,r.MEDIA_TYPE,e.getAvType(),r.MEDIA_ON_DEMAND,e.isOnDemand(),r.MEDIA_RETRIEVAL_TYPE,e.getRetrievalType(),r.MEDIA_LENGTH,e.getLength());var t=i(e);null!==t&&(this._mediaLabels[r.MEDIA_PID]=t.getValue()),e.getBitrate()&&(this._mediaLabels[r.MEDIA_BITRATE]=e.getBitrate()),e.getCDN()&&(this._mediaLabels[r.MEDIA_CDN]=e.getCDN()),e.getCodec()&&(this._mediaLabels[r.MEDIA_CODEC]=e.getCodec())},n.prototype.setMediaLength=function(e){this._mediaLabels[r.MEDIA_LENGTH]=e},n.prototype.setMediaBitrate=function(e){this._mediaLabels[r.MEDIA_BITRATE]=e},n.prototype.setMediaCodec=function(e){this._mediaLabels[r.MEDIA_CODEC]=e},n.prototype.setMediaCDN=function(e){this._mediaLabels[r.MEDIA_CDN]=e},n.prototype.avPlayEvent=function(e,t){this.ac._addEventAndSend(r.AV_PLAY_EVENT,o.extend(this._mediaLabels,!0,r.MEDIA_POSITION,e),t)},n.prototype.avPauseEvent=function(e,t){this.ac._addEventAndSend(r.AV_PAUSE_EVENT,o.extend(this._mediaLabels,!0,r.MEDIA_POSITION,e),t)},n.prototype.avBufferEvent=t,n.prototype.avEndEvent=function(e,t){this.ac._addEventAndSend(r.AV_END_EVENT,o.extend(this._mediaLabels,!0,r.MEDIA_POSITION,e),t)},n.prototype.avRewindEvent=function(e,t,n){this.ac._addEventAndSend(r.AV_RW_EVENT,o.extend(this._mediaLabels,!0,r.MEDIA_POSITION,e),n)},n.prototype.avFastForwardEvent=function(e,t,n){this.ac._addEventAndSend(r.AV_FF_EVENT,o.extend(this._mediaLabels,!0,r.MEDIA_POSITION,e),n)},n.prototype.avSeekEvent=function(e,t){this.ac._addEventAndSend(r.AV_SEEK_EVENT,o.extend(this._mediaLabels,!0,r.MEDIA_POSITION,e),t)},n.prototype.avUserActionEvent=function(e,t,n,i){this.ac._addEventAndSend(r.AV_UA_EVENT,o.extend(this._mediaLabels,!0,r.MEDIA_POSITION,n,r.USER_ACTION_TYPE,e,r.USER_ACTION_NAME,t),i)},n}),define("echo-8.0.0/delegate/spring/label-keys",{STREAM:"stream",PID:"cq",WIDTH:"sx",HEIGHT:"sy",PLAYER_DESC:"pl",PLAYER_VERSION:"plv"}),define("springstreams",[],function(){function e(e){function t(){var e={"2cnt.net":{syncrates:[3,7,10,10,10,10,10,60]}};return e}function n(e){var t;if(e){for(var n in e)n==R&&(t=e[n]);t&&i(t.syncrates)}}function i(e){e&&(w=e)}function r(){return w}function s(e,t,n){if(e){var i=new g(this,e,t,n);return V.push(i),i}}function o(){setInterval(u,N),setInterval(c,M)}function a(){for(var e=0;e<V.length;++e)try{V[e].stop()}catch(t){l(t)}}function u(e){for(var t=0;t<V.length;++t)try{V[t].update(e)}catch(n){l(n)}}function c(e){for(var t=0;t<V.length;++t)try{V[t].sync(e)}catch(n){l(n)}}function l(e){h("",e)}function p(e,t){return E([[e,t]])}function _(e){return e&&void 0!=e.site?e.site:D}function d(e){}function f(){return"https"==document.location.href.slice(0,5)?"https://ssl-":"http://"}function h(e,t){var n=f()+_(t)+"."+R+"/j0="+p(e,t);(new Image).src=n,this.debug(n)}function E(e){var t,n,i,r,s,o,a=/[+&,;=~]/g;switch(typeof e){case"string":return a.test(e)?escape(e).replace(a,function(e){var t=o[e];return t?t:e}):escape(e);case"number":return isFinite(e)?e.toString():"null";case"boolean":case"null":return e.toString();case"object":if(!e)return"null";if(t=[],"number"==typeof e.length&&!e.propertyIsEnumerable("length")){for(r=e.length,n=0;r>n;n+=1)t.push(E(e[n])||"null");return","+t.join("+")+";"}for(i in e)"string"==typeof i&&"site"!=i&&(s=E(e[i]),s&&t.push(E(i)+"="+s));return","+t.join("+")+";"}return""}function g(e,t,n,i){function r(e){var t=new Object;for(var n in e)t[n]=e[n];return t}function s(e){f.length<_.maxstates&&f.push(e)}function o(e){I=[e,e,Math.round((new Date).getTime()/1e3).toString(36)],s(I),S=!0,C=0}function a(){null!=v&&m<v.length&&(g=v[m++],_.debug("switch syncrate to "+g))}function u(e){if(!L){var t=I[1],n=t;try{n=Math.round(E.getPosition(d))}catch(i){}try{if(t==n)return void(C>=0&&(C++,C==_.pausesync&&(S=!0)));C>=_.pausesync?o(n):n-1>t?o(n):t>n?o(n):(I[1]=n,I[1]-I[0]>=g&&n-A>=g&&(S=!0,a()),C=0)}catch(r){l=!0,_.error(r)}}}function c(){L||(S=!0,L=!0,p(null))}function p(e){if(S){try{d.width&&(h.sx=d.width),d.videoWidth&&(h.sx=d.videoWidth),d.height&&(h.sy=d.height),d.videoHeight&&(h.sy=d.videoHeight)}catch(t){}h.uid=y,h.pst=f;var n;try{h.dur&&0!=h.dur||(h.dur=E.getDuration(d))}catch(t){}try{n=E.getMeta(d)}catch(t){}h.vt=Math.round((new Date).getTime()/1e3)-b,_.send(n,h),A=I[1]}S=!1}var _,d,f,h,E,g,v,m,y=Math.round(1e10*Math.random()).toString(36),b=Math.round((new Date).getTime()/1e3),I=[0,0,b.toString(36)],C=0,A=0,S=!0,L=!1;_=e,d=t,E=i?i:_.HTML5Adapter,h=r(n),f=new Array,f.push(I),m=0,g=e.syncrate,v=e.getSyncRates(),a(),this.update=u,this.stop=c,this.sync=p}function v(e){return{pl:"HTML 5 Video",pv:"HTML 5",sx:screen.width,sy:screen.height}}function m(e){return Math.round(e.duration)}function y(e){return e.currentTime}function b(e){return{pl:"DEF",pv:version,sx:screen.width,sy:screen.height}}function I(e){return(new Date).getTime()/1e3}function C(e){return 0}function A(e){return{pl:"MSWM",plv:e.versionInfo,sx:screen.width,sy:screen.height}}function S(e){return e.CurrentPosition?e.CurrentPosition:e.currentPosition?e.currentPosition:e.controls&&e.controls.currentPosition?e.controls.currentPosition:e.Controls&&e.Controls.currentPosition?e.Controls.currentPosition:0}function L(e){if(e.currentMedia){if(e.currentMedia.Duration)return e.currentMedia.Duration;if(e.currentMedia.duration)return e.currentMedia.duration}else if(e.CurrentMedia){if(e.CurrentMedia.duration)return e.CurrentMedia.duration;if(e.CurrentMedia.Duration)return e.CurrentMedia.Duration}}function O(e){return{pl:"RV",plv:e.GetVersionInfo(),sx:screen.width,sy:screen.height}}function T(e){return e.GetPosition()/1e3}function P(e){return e.GetLength()/1e3}this.version="1.4.0";var R="2cnt.net",N=200,M=2e3,D="default",V=new Array;this.syncrate=20,this.pausesync=6,this.maxstates=50;var w;n(t()),e&&(D=e),o(),this.getSyncRates=r,this.track=s,this.unload=a,this.doUpdate=u,this.doSync=c,this.error=l,this.debug=d,this.send=h,this.HTML5Adapter={getMeta:v,getPosition:y,getDuration:m},this.DefaultAdapter={getMeta:b,getPosition:I,getDuration:C},this.WMStreamAdapter={getMeta:A,getPosition:S,getDuration:L},this.RVStreamAdapter={getMeta:O,getPosition:T,getDuration:P}}return e}),define("echo-8.0.0/delegate/spring/spring-delegate",["require","./label-keys","../../config/keys","../../util/debug","./../../live-playhead","springstreams"],function(e){"use strict";function t(){return-1}function n(e,t,n,i){this._sensors=null,this._playerDelegate=null,this._media=null,this._meta={},this._stream=null,this._siteCode=n[r.BARB_SITE_CODE],this._debug=n[r.BARB_DEBUG],this._traceId=null,n[r.ECHO_TRACE]&&this.setTraceId(n[r.ECHO_TRACE])}var i=e("./label-keys"),r=e("../../config/keys"),s=e("../../util/debug"),o=e("./../../live-playhead");n.prototype.setTraceId=function(e){this._traceId=e},n.SpringStreams=e("springstreams");var a=new o;return n.prototype.addLabels=t,n.prototype.addLabel=t,n.prototype.addManagedLabel=t,n.prototype.removeLabels=t,n.prototype.removeLabel=t,n.prototype.setLoggedInToBBCId=t,n.prototype.setLoggedOutOfBBCId=t,n.prototype.setAppVersion=t,n.prototype.setCounterName=t,n.prototype.viewEvent=t,n.prototype.errorEvent=t,n.prototype.userActionEvent=t,n.prototype.setPlayerName=function(e){this._meta[i.PLAYER_DESC]=e},n.prototype.setPlayerVersion=function(e){this._meta[i.PLAYER_VERSION]=e},n.prototype.setPlayerIsPopped=t,n.prototype.setPlayerWindowState=t,n.prototype.setPlayerVolume=t,n.prototype.setPlayerIsSubtitled=t,n.prototype.setPlayerDelegate=function(e){return this._playerDelegate=e,this},n.prototype.setMedia=function(e){this.clearMedia(),this._media=e.getClone()},n.prototype.setMediaLength=function(e){this._media.setLength(e)},n.prototype.setMediaBitrate=t,n.prototype.setMediaCodec=t,n.prototype.setMediaCDN=t,n.prototype.avPlayEvent=function(e,t){if(null===this._media)return void s.warn("setMedia must be called before avPlayEvent");if(null===this._stream){this._initSensors();var n=this._getAttributes(),r=n[i.PID]||" ";if((this._media.isOnDemand()||this._media.isDownload())&&"function"!=typeof this._playerDelegate.getPosition)return void s.warn("Spring (BARB) reporting is disabled, to enable you must call echo.setPlayerDelegate");this._stream=this._sensors.track(r,n,this._getAdaptor())}this._media.isLive()&&a.start()},n.prototype._initSensors=function(){null===this._sensors&&(this._sensors=new n.SpringStreams(this._siteCode),this._debug&&(this._sensors.debug=function(e){s.info("Spring DEBUG: "+e)}))},n.prototype._getMostPrecedentIdObject=function(){var e=this._media.getVersionIdObject(),t=this._media.getEpisodeIdObject(),n=this._media.getClipIdObject(),i=this._media.getVpIdObject(),r=this._media.getServiceIdObject();return e.isValueValid()?e:t.isValueValid()?t:n.isValueValid()?n:i.isValueValid()?i:r.isValueValid()?r:null},n.prototype._getAttributes=function(){var e=this._media,t={};if(this._traceId&&(t[r.ECHO_TRACE]=this._traceId),!e.isLive()){var n=this._getMostPrecedentIdObject();null!==n&&(t[i.PID]=n.getValue())}return e.isOnDemand()?t[i.STREAM]="od":e.isDownload()?t[i.STREAM]="dwn":e.isLive()&&(e.getServiceIdObject().isValueValid()?t[i.STREAM]="live/"+e.getServiceId():e.getVpIdObject().isValueValid()&&(t[i.STREAM]="live/"+e.getVpId())),t},n.prototype._getAdaptor=function(){var e,t=this;return e=this._media.isLive()?function(){return a.getPosition()}:this._playerDelegate.getPosition,{getMeta:function(e){return t._meta},getDuration:function(e){return Math.floor(t._media.getLength()/1e3)},getPosition:function(t){return Math.floor(e()/1e3)}}},n.prototype.avPauseEvent=function(){this._media.isLive()&&(this._stream&&(this._stream.stop(),this._stream=null),a.reset())},n.prototype.avBufferEvent=function(){this._media.isLive()&&a.stop()},n.prototype.avEndEvent=function(){null!==this._media&&(this._media.isLive()&&a.reset(),this.clearMedia())},n.prototype.avRewindEvent=function(){this._media.isLive()&&a.stop()},n.prototype.avFastForwardEvent=function(){this._media.isLive()&&a.stop()},n.prototype.avSeekEvent=function(){this._media.isLive()&&a.stop()},n.prototype.avUserActionEvent=t,n.prototype.clearMedia=function(){null!==this._media&&(this._stream&&(s.warn("Calling stream.stop()"),this._stream.stop()),this._stream=null,this._media=null)},n}),define("echo-8.0.0/client",["require","./util/debug","./util/methods","./config/keys","./enumerations","./live-broker","./delegate/comscore/label-keys","./config/generator","./util/cleansing/label-cleanser","./util/methods","./delegate/comscore/comscore-delegate","./delegate/rum/rum-delegate","./delegate/spring/spring-delegate","./environment"],function(e){"use strict";function t(e,n,o,a){i.assertContainsValue(s.ApplicationType,n,'appType should be one of Enums.ApplicationType, got "'+n+'"'),this.state={counterNameSet:!1};var u=t.ConfigGenerator.generate(o);u&&u[r.ECHO_ENABLED]||this._disable(),this._env=a||new t.Environment;var c=t.Environment._defaultGetCookie("bbc_identity");this.bbcCookies=this._env.getCookiePolicy(),"1"===c&&this.setLoggedInToBBCId(),this._configureForPerfCookies(u);var l=t.LabelCleanser.cleanLabelValue("app_name",e);this._setConsumers(l,n,u,this._env),this._deviceID=void 0,u&&u[r.ECHO_DEVICE_ID]&&(this._deviceID=u[r.ECHO_DEVICE_ID]),this._playerDelegate=null,this._liveBroker=null}var n=e("./util/debug"),i=e("./util/methods"),r=e("./config/keys"),s=e("./enumerations"),o=e("./live-broker"),a=e("./delegate/comscore/label-keys");return t.prototype.setTraceId=function(e){this._delegate("setTraceId",[e])},t.ConfigGenerator=e("./config/generator"),t.LabelCleanser=e("./util/cleansing/label-cleanser"),t.Util=e("./util/methods"),t.ComScoreDelegate=e("./delegate/comscore/comscore-delegate"),t.RumDelegate=e("./delegate/rum/rum-delegate"),t.SpringDelegate=e("./delegate/spring/spring-delegate"),t.Environment=e("./environment"),t.prototype._configureForPerfCookies=function(e){var t=this.bbcCookies.hasOptedOutOfPerformanceCookies();e&&t&&(e[r.BARB_ENABLED]=!1)},t.prototype._setConsumers=function(e,n,i,s){return this._isDisabled()?void(this.consumers={}):(this.consumers={},i[r.COMSCORE_ENABLED]&&(this.consumers[t.Consumers.COMSCORE]=new t.ComScoreDelegate(e,n,i,s)),i[r.RUM_ENABLED]&&(this.consumers[t.Consumers.RUM]=new t.RumDelegate(e,n,i,s)),i[r.BARB_ENABLED]&&(this.consumers[t.Consumers.BARB]=new t.SpringDelegate(e,n,i,s)),this)},t.prototype._delegate=function(e,t){for(var n in this.consumers)n&&this.consumers[n][e].apply(this.consumers[n],t);return this},t.prototype._disable=function(){return n.info("EchoClient disabled"),this._disabled=!0,this._setConsumers(),this},t.prototype._isDisabled=function(){return this._disabled},t.prototype.addLabels=function(e){return this._delegate("addLabels",[t.LabelCleanser.cleanLabels(e)]),this},t.prototype.addLabel=function(e,t){if("string"!=typeof e)return void n.error("Label key must be a string");if(!t)return void n.error("Label cannot be null/undefined");var i={};return i[e]=t,this.addLabels(i)},t.prototype.addManagedLabel=function(e,n){return this._delegate("addManagedLabel",[t.LabelCleanser.cleanLabelKey(e),t.LabelCleanser.cleanLabelValue(e,n)]),this},t.prototype.removeLabels=function(e){for(var n=[],i=0,r=e.length;r>i;i++)n.push(t.LabelCleanser.cleanLabelKey(e[i]));return this._delegate("removeLabels",[n]),this},t.prototype.removeLabel=function(e){return this.removeLabels([e])},t.prototype.setLoggedInToBBCId=function(e){
return this._delegate("setLoggedInToBBCId",[e]),this},t.prototype.setLoggedOutOfBBCId=function(){return this._delegate("setLoggedOutOfBBCId"),this},t.prototype.setAppVersion=function(e){return this._delegate("setAppVersion",[e]),this},t.prototype.setCounterName=function(e){return e=t.LabelCleanser.cleanCounterName(e),this._delegate("setCounterName",[e]),this.state.counterNameSet=!0,this},t.prototype.setContentLanguage=function(e){return this._delegate("setContentLanguage",[e]),this},t.prototype.getDeviceID=function(){if(this._deviceID)return this._deviceID;this.state.comscoreEventSent||n.warn("Call to getDeviceID before any events were sent, this could mean that the s1 cookie is not yet set on the client.");var e=this._env.getCookieGetter()||t.Environment._defaultGetCookie;return e("s1")},t.prototype.viewEvent=function(e,n){return e=t.LabelCleanser.cleanCounterName(e),this._delegate("viewEvent",[e,t.LabelCleanser.cleanLabels(n)]),this.state.counterNameSet=!0,this.consumers[t.Consumers.COMSCORE]&&(this.state.comscoreEventSent=!0),this},t.prototype.userActionEvent=function(e,i,r){var s=!1;return r&&r.name&&(s=!0,r.name=t.LabelCleanser.cleanCounterName(r.name)),this.state.counterNameSet||s?(this._delegate("userActionEvent",[e,i,t.LabelCleanser.cleanLabels(r)]),this.consumers[t.Consumers.COMSCORE]&&(this.state.comscoreEventSent=!0),this):(n.error('userActionEvent: Countername not set. Either pass in a "name" label or send a viewEvent/call setcounterName first'),this)},t.prototype.errorEvent=function(e,n){return this._delegate("errorEvent",[e,t.LabelCleanser.cleanLabels(n)]),this},t.prototype.setPlayerName=function(e){i.assert("string"==typeof e&&e.length>0,'setPlayerName: name must be string with length, got "'+e+'"');var n=t.LabelCleanser.cleanLabelValue("player_name",e);return this._delegate("setPlayerName",[n]),this},t.prototype.setPlayerVersion=function(e){i.assert("string"==typeof e&&e.length>0,'setPlayerVersion: version must be string with length, got "'+e+'"');var n=t.LabelCleanser.cleanLabelValue("player_version",e);return this._delegate("setPlayerVersion",[n]),this},t.prototype.setPlayerIsPopped=function(e){return i.assert("boolean"==typeof e,'setPlayerIsPopped: isPopped must be boolean, got "'+e+'"'),this._delegate("setPlayerIsPopped",[e]),this},t.prototype.setPlayerWindowState=function(e){return i.assertContainsValue(s.WindowState,e,'The window state must be set as a member of Enums.WindowState, got "'+e+'"'),this._delegate("setPlayerWindowState",[e]),this},t.prototype.setPlayerVolume=function(e){return i.assert(100>=e&&e>=0,"volume must be 0-100, got: "+e),100>=e&&e>=0&&this._delegate("setPlayerVolume",[e]),this},t.prototype.setPlayerIsSubtitled=function(e){return i.assert("boolean"==typeof e,'setPlayerIsSubtitled: isSubtitled must be a boolean, got "'+e+'"'),this._delegate("setPlayerIsSubtitled",[e]),this},t.prototype.setPlayerDelegate=function(e){e=e||{};var t,n,r,s=["getTimestamp","getPosition"],o=!1;for(n in s)t=s[n],r=e.hasOwnProperty(t)&&"function"==typeof e[t],i.assert(r,'The player delegate must implement "'+t+'"'),r||(o=!0);return o||(this._playerDelegate=e,this._delegate("setPlayerDelegate",[e])),this},t.prototype.setMedia=function(e){var t=e.getClone();if(this._clearMedia(),!this.state.counterNameSet)return n.error("setMedia: Must have a countername set or view event sent first"),void(this.media=null);this._delegate("setMedia",[t]),this.media=t;var i=s.MediaConsumptionMode.LIVE;this.media.getMediaConsumptionMode()===i&&this._initLiveBroker()},t.prototype.setMediaLength=function(e){return this.media?this.media.isOnDemand()?0>e?(n.error('setMediaLength: Length must be gretaer than zero for on-demand media, got "'+e+'"'),this):(this._delegate("setMediaLength",[e]),this):(n.error("setMediaLength: Length should be set to zero prior to passing the media object to Echo for live media"),this):(n.error("setMediaLength: Must call setMedia first"),this)},t.prototype.setMediaBitrate=function(e){return i.assert(e>0,'setMediaBitrate: bitrate must be > 0, got "'+e+'"'),this._delegate("setMediaBitrate",[e]),this},t.prototype.setMediaCodec=function(e){return i.assert("string"==typeof e,'setMediaCodec: must be string value, got "'+typeof e+'"'),this._delegate("setMediaCodec",[e]),this},t.prototype.setMediaCDN=function(e){return i.assert("string"==typeof e,'setMediaCDN: must be string value, got "'+typeof e+'"'),this._delegate("setMediaCDN",[e]),this},t.prototype._avEventsEnabled=function(){return i.assert(!!this.media,"setMedia() must be called prior to this method")&&i.assert(!!this._playerDelegate,"setPlayerDelegate not called or not configured correctly")},t.prototype.avPlayEvent=function(e,n){return this._avEventsEnabled()?(this._liveBroker&&(e=this._liveBroker.getPosition(),this._liveBroker.start()),this._delegate("avPlayEvent",[e,t.LabelCleanser.cleanLabels(n)]),this.consumers[t.Consumers.COMSCORE]&&(this.state.comscoreEventSent=!0),this):void 0},t.prototype.avPauseEvent=function(e,n){return this._avEventsEnabled()?(this._liveBroker&&(this._liveBroker.stop(),e=this._liveBroker.getPosition()),this._delegate("avPauseEvent",[e,t.LabelCleanser.cleanLabels(n)]),this):void 0},t.prototype._initLiveBroker=function(){this._avEventsEnabled()&&this.media.getMediaConsumptionMode()===s.MediaConsumptionMode.LIVE&&(this._liveBroker=new o(this._playerDelegate,this.media.getServiceId()||this.media.getVersionId(),this),this._liveBroker.start())},t.prototype.avBufferEvent=function(e,n){return this._avEventsEnabled()?(this._liveBroker&&(e=this._liveBroker.getPosition(),this._liveBroker.stop()),this._delegate("avBufferEvent",[e,t.LabelCleanser.cleanLabels(n)]),this):void 0},t.prototype.avEndEvent=function(e,n){return this._avEventsEnabled()?(this._liveBroker&&(e=this._liveBroker.getPosition(),this._liveBroker.stop()),this._delegate("avEndEvent",[e,t.LabelCleanser.cleanLabels(n)]),this):void 0},t.prototype.avRewindEvent=function(e,n,i){return this._avEventsEnabled()?(this._liveBroker&&(e=this._liveBroker.getPosition(),this._liveBroker.stop()),this._delegate("avRewindEvent",[e,n,t.LabelCleanser.cleanLabels(i)]),this):void 0},t.prototype.avFastForwardEvent=function(e,n,i){return this._avEventsEnabled()?(this._liveBroker&&(e=this._liveBroker.getPosition(),this._liveBroker.stop()),this._delegate("avFastForwardEvent",[e,n,t.LabelCleanser.cleanLabels(i)]),this):void 0},t.prototype.avSeekEvent=function(e,n){return this._avEventsEnabled()?(this._liveBroker&&(e=this._liveBroker.getPosition(),this._liveBroker.stop()),this._delegate("avSeekEvent",[e,t.LabelCleanser.cleanLabels(n)]),this):void 0},t.prototype.avUserActionEvent=function(e,n,i,r){if(this._avEventsEnabled()){this._liveBroker&&(i=this._liveBroker.getPosition());var s=t.LabelCleanser.cleanLabels(r);return this._delegate("avUserActionEvent",[e,n,i,s]),this}},t.prototype._clearMedia=function(){this.removeLabel(a.MEDIA_TIMESTAMP),null!==this.media&&(this.media=null),this._liveBroker instanceof o&&(this._liveBroker.stop(),this._liveBroker=null)},t.Consumers={COMSCORE:1,RUM:2,BARB:4},t}),define("echo-8.0.0/media-id",["require","./util/methods"],function(e){"use strict";var t=e("./util/methods"),n=function(e){this.idType=e,this.validValueRegex=/^[a-z0-9A-Z_-]+$/,this.value=null,this.isSet=!1,this.isValid=!1};return n.prototype.getIdType=function(){return this.idType},n.prototype.setValue=function(e){this.isSet=!0,this.isValid=this._validateValue(e),t.assert(this.isValid,"MediaId: The value for "+this.idType+"Id is invalid",!0),this.value=e},n.prototype.getValue=function(){return this.value},n.prototype.isValueSet=function(){return this.isSet},n.prototype.isValueValid=function(){return this.isValid},n.prototype._validateValue=function(e){return"string"==typeof e?this.validValueRegex.test(e):!1},n}),define("echo-8.0.0/media",["require","./media-id","./enumerations","./util/methods","./util/debug"],function(e){"use strict";function t(e){return e===r.AvType.AUDIO||e===r.AvType.VIDEO}function n(e){return e===a.ON_DEMAND||e===a.DOWNLOAD||e===a.LIVE}var i=e("./media-id"),r=e("./enumerations"),s=e("./util/methods"),o=e("./util/debug"),a=r.MediaConsumptionMode,u=function(e,o){this.avType=t(e)?e:null,this.consumptionMode=n(o)?o:null,s.assert(this.avType,"Media: Invalid avType: "+this.avType,!0),s.assert(this.consumptionMode,"Media: Invalid consumptionMode: "+this.consumptionMode,!0),this.serviceIdObject=new i(r.MediaIdType.SERVICE),this.versionIdObject=new i(r.MediaIdType.VERSION),this.clipIdObject=new i(r.MediaIdType.CLIP),this.episodeIdObject=new i(r.MediaIdType.EPISODE),this.vpIdObject=new i(r.MediaIdType.VPID),this.length=0,this.scheduleMode=null,this.bitrate=0,this.codec=null,this.cdn=null};return u.prototype.getAvType=function(){return this.avType},u.prototype.getMediaConsumptionMode=function(){return this.consumptionMode},u.prototype.getClone=function(){var e=new u(this.avType,this.consumptionMode);return e.serviceIdObject=this.serviceIdObject,e.versionIdObject=this.versionIdObject,e.clipIdObject=this.clipIdObject,e.episodeIdObject=this.episodeIdObject,e.vpIdObject=this.vpIdObject,e.length=this.length,e.scheduleMode=this.scheduleMode,e.bitrate=this.bitrate,e.codec=this.codec,e.cdn=this.cdn,e},u.prototype.setVersionId=function(e){return this.versionIdObject.setValue(e),this},u.prototype.setClipId=function(e){return this.clipIdObject.setValue(e),this},u.prototype.setServiceId=function(e){return this.serviceIdObject.setValue(e),this},u.prototype.setEpisodeId=function(e){return this.episodeIdObject.setValue(e),this},u.prototype.setVpId=function(e){return this.vpIdObject.setValue(e),this},u.prototype.setLength=function(e){return e&&e>=0&&!this.isLive()?this.length=Math.floor(e):this.isLive()?o.warn("Media: call to setLength ignored length is fixed at 0s for live media"):o.warn("Media: length must be 0s or greater for on demand or downloaded media"),this},u.prototype.setBitrate=function(e){return e&&e>0?this.bitrate=e:o.warn("Invalid media bitrate: "+e),this},u.prototype.setCodec=function(e){return this.codec=e,this},u.prototype.setCDN=function(e){return this.cdn=e,this},u.prototype.setScheduleMode=function(e){return e===r.EchoScheduleMode.ON||e===r.EchoScheduleMode.OFF?this.scheduleMode=e:(this.scheduleMode=null,o.warn("Media: Invalid scheduleMode: "+this.scheduleMode)),this},u.prototype.getVersionIdObject=function(){return this.versionIdObject},u.prototype.getClipIdObject=function(){return this.clipIdObject},u.prototype.getServiceIdObject=function(){return this.serviceIdObject},u.prototype.getEpisodeIdObject=function(){return this.episodeIdObject},u.prototype.getVpIdObject=function(){return this.vpIdObject},u.prototype.getVersionId=function(){return this.versionIdObject.getValue()},u.prototype.getClipId=function(){return this.clipIdObject.getValue()},u.prototype.getServiceId=function(){return this.serviceIdObject.getValue()},u.prototype.getEpisodeId=function(){return this.episodeIdObject.getValue()},u.prototype.getVpId=function(){return this.vpIdObject.getValue()},u.prototype.getLength=function(){return this.length},u.prototype.getScheduleMode=function(){return this.scheduleMode},u.prototype.getBitrate=function(){return this.bitrate},u.prototype.getCDN=function(){return this.cdn},u.prototype.getCodec=function(){return this.codec},u.prototype.getRetrievalType=function(){if(null===this.consumptionMode)return null;var e=this.consumptionMode===a.DOWNLOAD?r.RetrievalType.DOWNLOAD:r.RetrievalType.STREAM;return e},u.prototype.isOnDemand=function(){return this.consumptionMode===a.ON_DEMAND},u.prototype.isDownload=function(){return this.consumptionMode===a.DOWNLOAD},u.prototype.isLive=function(){return this.consumptionMode===a.LIVE},u.prototype.isVideo=function(){return this.avType===r.AvType.VIDEO},u}),define("echo-8.0.0/bootstrap",["require","./meta","./client","./media","./media-id","./environment","./enumerations","./config/keys","./util/debug"],function(e){"use strict";var t=e("./meta"),n={EchoClient:e("./client"),Media:e("./media"),MediaId:e("./media-id"),Environment:e("./environment"),Enums:e("./enumerations"),ConfigKeys:e("./config/keys"),Debug:e("./util/debug"),getAPIVersion:function(){return t.API_VERSION},getImplementationVersion:function(){return t.VERSION}};return n}),define("echo-8.0.0",["require","echo-8.0.0/bootstrap"],function(e){"use strict";return e("echo-8.0.0/bootstrap")}),define("echo",["echo-8.0.0"],function(e){var t,n,i=function(i){if(n=i,e){n.isDev&&e.Debug.enable();var r=(e.Media,e.EchoClient),s=e.Enums,o=e.ConfigKeys,a=(e.Environment,{});n.isDev&&(a[o.ECHO_TRACE]=n.echoCounterName+"Dev-"+Math.random(),a[o.TEST_SERVICE_ENABLED]=!0,a[o.TEST_SERVICE_URL]="http://echo-chamber.api.bbci.co.uk"),t=new r(n.appName,s.ApplicationType.WEB,a);var u="1.0.0";t.setAppVersion(u);var c={version:u,environment:n.environment};t.addManagedLabel(s.ManagedLabels.BBC_SITE,"taster"),t.viewEvent("taster.pilot."+n.echoCounterName+".internal.page",c)}},r=function(i,r){e&&t&&(n.isDev&&console.log("Tracking user action: type="+i+", name="+r),t.userActionEvent(i,r))};window._ECHOJS={init:i,track:r}}),require(["echo"]);